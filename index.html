<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LoL Lane Coach — Offline (Summoner's Rift)</title>
<meta name="description" content="Pick lane → your champ → enemy champ. Matchup-aware lane plans, items, runes. Works offline on mobile & desktop." />
<style>
.feedback-link { display:inline-flex; align-items:center; gap:6px; background:#fffae6; color:#0056b3; padding:6px 10px; border-radius:999px; text-decoration:none; font-weight:700; white-space:nowrap; line-height:1; }
.feedback-link:hover { background:#fff3cd; color:#003d80; transition:0.25s; }

  :root{ --bg:#0a0f1a; --panel:#0e1424; --line:#1b2440; --ink:#e9edff; --muted:#a8b3d5; --acc:#60a5ff; }
  *{ box-sizing:border-box }
  body{ margin:0; background:radial-gradient(1200px 800px at 50% -10%,#142042 6%,#0a0f1a 55%); color:var(--ink);
        font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial }
  header{ position:sticky; top:0; z-index:10; background:rgba(10,15,26,.7); backdrop-filter:blur(8px); border-bottom:1px solid var(--line) }
  .wrap{ max-width:1000px; margin:0 auto; padding:.9rem 1rem }
  h1{ margin:.1rem 0; font-size:1.1rem }
  .sub{ color:var(--muted); font-size:.92rem }
  main{ min-height:calc(100dvh - 64px); display:grid; place-items:start center }
  .card{ width:min(980px,94vw); margin:1rem auto; background:linear-gradient(180deg,#0f1530,#0d1328);
         border:1px solid var(--line); border-radius:16px; padding:1rem }
  .row{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:.6rem }
  @media (max-width:900px){ .row{ grid-template-columns:1fr } }
  .picker{ position:relative; border:1px solid var(--line); background:#0b1220; border-radius:12px;
           padding:.45rem .6rem; display:flex; align-items:center; gap:.6rem }
  .picker input, .picker select{ flex:1; background:transparent; border:0; outline:0; color:var(--ink); font-size:1rem }
  .optbox{ position:absolute; left:0; right:0; top:100%; background:#0b1220; border:1px solid var(--line);
           border-radius:12px; margin-top:.35rem; max-height:280px; overflow:auto; z-index:20; display:none }
  .opt{ padding:.42rem .6rem; border-bottom:1px solid #111a31; cursor:pointer }
  .opt:hover{ background:#0f1a33 }
  .cta{ display:flex; gap:.5rem; flex-wrap:wrap; margin-top:.6rem }
  button{ background:#172553; border:1px solid #24336d; color:#fff; border-radius:10px; padding:.55rem .85rem; cursor:pointer }
  button[disabled]{ opacity:.6; cursor:not-allowed }
  .pill{ display:inline-flex; align-items:center; gap:.35rem; border:1px solid var(--line); background:#0e1733;
         padding:.25rem .55rem; border-radius:999px; font-size:.85rem }
  .grid{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:.6rem; margin-top:.7rem }
  @media (max-width:760px){ .grid{ grid-template-columns:1fr } }
  .kv{ border:1px solid var(--line); background:#0b1220; border-radius:12px; padding:.65rem }
  .kv h4{ margin:.1rem 0 .35rem; color:#cfe1ff; font-size:.95rem }
  .tags{ display:flex; flex-wrap:wrap; gap:.35rem }
  .tag{ border:1px solid #2b3868; background:#0e1733; border-radius:999px; padding:.22rem .55rem; font-size:.84rem; color:#d7e8ff }
  ul{ margin:.2rem 0 .2rem 1rem; line-height:1.45 }
  .muted{ color:var(--muted) }

/* ---- Scaling & Posture Visuals ---- */
.badge {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 999px;
  font-weight: 600;
  font-size: 0.85rem;
}
.badge.aggressive { background: #e6ffed; color: #127a2a; border: 1px solid #b7f5c5; }
.badge.neutral   { background: #fff8e6; color: #8a6d1a; border: 1px solid #f5e1a3; }
.badge.defensive { background: #ffe6e6; color: #8a1a1a; border: 1px solid #f5b7b7; }

.scaling-wrap { display:flex; flex-direction:column; gap:8px; }
.scaling-chart { display:flex; flex-direction:column; gap:8px; }
.scaling-row { display:grid; grid-template-columns: 56px 1fr; align-items:center; gap:12px; }
.scaling-row .label { font-size: 0.9rem; color: var(--muted); text-align:right; }
.scaling-bars { position:relative; display:flex; gap:6px; align-items:center; }
.scaling-bar {
  height: 18px;
  border-radius: 6px;
  position:relative;
  min-width: 4%;
}
.scaling-bar.you { background: rgba(64,128,255,0.18); border: 1px solid rgba(64,128,255,0.35); }
.scaling-bar.them{ background: rgba(255,64,64,0.18); border: 1px solid rgba(255,64,64,0.35); }
.scaling-num {
  position:absolute;
  right:6px;
  top:50%;
  transform: translateY(-50%);
  font-size: 0.78rem;
  color:#333;
}
.scaling-legend { font-size: 0.85rem; color: var(--muted); }
.posture-blurbs { margin:0; padding-left: 18px; }
.posture-blurbs li { margin: 2px 0; }

@media (max-width: 520px){
  .scaling-row { grid-template-columns: 52px 1fr; }
  .scaling-bars { flex-direction:column; gap:6px; }
  .scaling-bar { width:100% !important; }
  .scaling-num { right:8px; }
}

/* ===== Pro UI Overhaul (desktop & mobile) ===== */
:root{
  --bg: #0b1020;
  --panel: #121733;
  --panel-2:#0e1430;
  --elev: rgba(255,255,255,0.06);
  --text: #e8edff;
  --muted: #a7b0d6;
  --brand: #5b86ff;
  --brand-2:#7ac8ff;
  --red: #ff6b6b;
  --green:#45d483;
  --yellow:#ffd166;
  --border: rgba(255,255,255,0.12);
  --shadow: 0 10px 30px rgba(0,0,0,0.45);
  --radius: 16px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background: radial-gradient(1200px 800px at 10% -10%, rgba(91,134,255,0.18), transparent),
              radial-gradient(1200px 800px at 110% 10%, rgba(122,200,255,0.12), transparent),
              var(--bg);
  color: var(--text);
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  line-height:1.5;
}
a{color:var(--brand);text-decoration:none}
a:hover{color:#9ab5ff}
.container{
  max-width: 1080px;
  margin: 0 auto;
  padding: 24px;
}
.header{
  position: sticky; top:0; z-index: 20;
  backdrop-filter: blur(8px);
  background: linear-gradient(180deg, rgba(11,16,32,0.92), rgba(11,16,32,0.5) 70%, transparent);
  border-bottom:1px solid var(--border);
}
.header-inner{
  display:flex; align-items:center; justify-content:space-between;
  max-width:1080px; margin:0 auto; padding:14px 24px;
}
.brand{
  display:flex; align-items:center; gap:10px; font-weight:700; letter-spacing:.3px;
}
.brand .logo{
  width:28px; height:28px; border-radius:8px;
  background: linear-gradient(135deg, var(--brand), var(--brand-2));
  box-shadow:0 4px 14px rgba(91,134,255,0.5);
}
.actions{display:flex; gap:10px; align-items:center}
.btn{
  background: linear-gradient(180deg, #1a2150, #131a44);
  color:var(--text);
  border:1px solid var(--border);
  border-radius: 12px;
  padding:10px 14px; font-weight:600; cursor:pointer;
  transition: transform .06s ease, background .2s ease, border-color .2s ease, box-shadow .2s ease;
  box-shadow: var(--shadow);
}
.btn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,0.25); }
.btn.primary{ background: linear-gradient(180deg, #4667ff, #3854d6); border-color: rgba(255,255,255,0.2); }
.btn.ghost{ background: rgba(255,255,255,0.06); }
.select, .input{
  width:100%; padding:12px 14px;
  background: #0e1430; color: var(--text);
  border:1px solid var(--border); border-radius:12px;
  outline:none; transition:border-color .2s ease, box-shadow .2s ease;
}
.select:focus, .input:focus{ border-color:#7aa2ff; box-shadow: 0 0 0 3px rgba(90,140,255,0.25); }
.grid{ display:grid; gap:18px; }
@media(min-width: 960px){ .grid.cols-2{ grid-template-columns: 1.1fr .9fr; } }
.card{
  background: linear-gradient(180deg, var(--panel), var(--panel-2));
  border:1px solid var(--border);
  box-shadow: var(--shadow);
  border-radius: var(--radius);
  padding: 18px 18px 16px;
}
.card h3{ margin: 0 0 12px 0; font-size:1.05rem; letter-spacing:.2px; }
.section-title{ margin: 0 0 8px 0; font-size:1.1rem; font-weight:700; }
.inline{ display:flex; gap:10px; align-items:center; }
.stack{ display:flex; flex-direction:column; gap:12px; }

.kv{ margin-bottom: 10px; padding: 12px; border-radius: 12px; background: rgba(255,255,255,0.04); border:1px solid var(--border); }
.kv h4{ margin:0 0 10px 0; font-size: .95rem; color:#bfc7ee; letter-spacing:.3px; }

.tags{ display:flex; flex-wrap:wrap; gap:8px;}
.tag{ padding:6px 10px; border-radius:999px; background: rgba(255,255,255,0.07); border:1px solid var(--border); color:var(--text); font-size:.85rem; }
.tag.ghost{ background:none; border-style:dashed; color:var(--muted); }
#postureBadge.badge{ box-shadow: inset 0 -1px 0 rgba(255,255,255,0.12), 0 6px 24px rgba(0,0,0,0.35); }

/* Scaling visuals tweak */
.scaling-wrap{ gap:10px; }
.scaling-row .label{ color:#b7c3ff; font-weight:600; }
.scaling-bar.you{ background: linear-gradient(90deg, rgba(84,142,255,.25), rgba(84,142,255,.12)); border-color: rgba(84,142,255,.5); }
.scaling-bar.them{ background: linear-gradient(90deg, rgba(255,92,92,.25), rgba(255,92,92,.12)); border-color: rgba(255,92,92,.5); }
.scaling-num{ color:#f4f7ff; text-shadow: 0 1px 0 rgba(0,0,0,.3); }

/* Inputs row */
.inputs{ display:grid; gap:10px; grid-template-columns: 1fr 1fr 160px; }
@media(max-width: 720px){ .inputs{ grid-template-columns: 1fr; } }
.helper{ font-size:.9rem; color: var(--muted); }

.footer{ margin: 18px auto 36px; max-width:1080px; padding: 0 24px; color: var(--muted); font-size:.9rem; display:flex; justify-content:space-between; gap:10px; }
.small{ font-size:.85rem; color:var(--muted); }
hr.sep{ border:none; height:1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,.12), transparent); margin: 12px 0; }

/* Role Tips list */
#roleTips li{ margin:4px 0; }
#plan .muted{ color: var(--muted); }


.verified-chip{ display:inline-flex; align-items:center; gap:6px; margin-left:8px; padding:3px 8px; border-radius:999px; border:1px solid var(--border); color:var(--muted); font-size:.75rem; }
.verified-chip svg{ width:12px; height:12px; opacity:.9; }
@media(max-width:640px){ .verified-chip{ margin-left:6px; padding:3px 6px; font-size:.72rem; } .feedback-link{ font-size:.9rem; padding:6px 10px; } }

/* Mobile flow for How to use */
@media(max-width:768px){
  #how .grid{ display:grid; grid-template-columns: 1fr; gap:12px !important; }
  #how .inline{ align-items:flex-start; }
  #how .tag{ width:24px; height:24px; display:inline-flex; align-items:center; justify-content:center; border-radius:999px; background:rgba(255,255,255,0.06); font-weight:700; }
  #how .kv{ margin-top:4px; }
}

/* Lane picker accent */
.lane-accent{ color:#7aa2ff; }
.lane-accent select.select{ border-color:#7aa2ff; box-shadow:0 0 0 2px rgba(122,162,255,0.15) inset; }
</style>
</head>
<body>
<div class="header"><div class="header-inner"><div class="brand"><div class="logo"></div><div>Matchup Coach</div></div><div class="actions"><a class="btn ghost" href="#how">How it works</a><a class="btn primary" href="#analyze">Analyze Matchup</a></div></div></div>
<div class="container">
<header>
  <div class="wrap">
    <h1>LoL Lane Coach (Offline — SR)</h1>
    <div class="sub">Pick lane → your champ → enemy champ. Tailored lane plans, items, runes. Works offline; mobile + desktop.</div>
  </div>
</header>

<main>
  <section class="card">
    <div class="row">
      <label class="picker">Lane
        <select class="select" id="lane">
          <option value="top">Top</option>
          <option value="jungle">Jungle</option>
          <option value="mid" selected>Mid</option>
          <option value="adc">ADC</option>
          <option value="support">Support</option>
        </select>
      </label>
      <div class="picker">
        <input class="input" id="you" placeholder="Your champion (e.g., Ahri)" autocomplete="off" />
        <div class="optbox" id="youList"></div>
      </div>
      <div class="picker">
        <input class="input" id="them" placeholder="Enemy champion (e.g., Zed)" autocomplete="off" />
        <div class="optbox" id="themList"></div>
      </div>
    </div>
    <div class="cta">
      <button id="analyze" class="btn primary">Analyze matchup</button>
      <button id="swap" class="btn ghost">Swap (you ⇄ them)</button>
      <span class="pill" id="status">Ready</span>
    </div>

    <div id="results" style="display:none">
      <div class="grid">
        <div class="kv" style="grid-column:1/-1">
          <h4>Matchup</h4>
          <div class="tags">
            <span class="tag" id="youBadge"></span>
            <span class="tag">vs</span>
            <span class="tag" id="themBadge"></span>
            <span class="tag" id="laneBadge"></span>
            <span class="tag" id="postureBadge"></span>
          </div>
        </div>
        <div class="kv">
          <h4>Summoners</h4>
          <div class="tags" id="summoners"></div>
          <div class="muted" id="sumNotes"></div>
        </div>
        <div class="kv">
          <h4>Runes</h4>
          <div class="tags" id="runes"></div>
          <div class="muted" id="runeNotes"></div>
        </div>
        <div class="kv">
          <h4>Start</h4>
          <div class="tags" id="start"></div>
        </div>
        <div class="kv">
          <h4>Core</h4>
          <div class="tags" id="core"></div>
        </div>
        <div class="kv">
          <h4>Situational</h4>
          <div class="tags" id="situational"></div>
        </div>
        <div class="kv">
          <h4>Skill Order</h4>
          <div class="tags" id="skills"></div>
        </div>
        <div class="kv">
          <div style="display:flex;justify-content:space-between;align-items:center;"><h4 style="margin:0">Scaling & Posture</h4><label style="display:flex;gap:8px;align-items:center;font-size:0.9rem;"><input class="input" type="checkbox" id="beginnerToggle"> Beginner mode</label></div><div class="scaling-wrap"><span id="postureBadge" class="badge"></span><div id="postureAdvice" class="muted"></div><ul id="postureTips" class="posture-blurbs"></ul><div id="scalingChart" class="scaling-chart"></div><div class="scaling-legend">E/M/L = Early / Mid / Late game strength.</div></div></div>
          <div class="muted" id="scalingNotes"></div>
<div class="muted" id="scalingLegend">E/M/L = Early / Mid / Late game strength. Use posture to decide if you push pace or stall for spikes.</div>
        </div>
        <div class="kv">
          <h4>Role Tips</h4>
          <ul id="roleTips"></ul>
        </div>

        <div class="kv" style="grid-column:1/-1">
          <h4>Lane plan</h4>
          <ul id="plan"></ul>
          <div class="muted" id="extras"></div>
          <div class="cta" style="margin-top:.5rem">
            <button id="copy">Copy plan</button>
            <button id="reset" class="btn ghost">Reset</button>
          </div>
        </div>
      </div>
    </div>

  </section>
</main>

<script>





function lookupCurated(lane, youName, themName){
  const L = (lane||"").toLowerCase();
  const table = MATCHUP_TIPS[L];
  if(!table) return null;
  const key = `${youName}|${themName}`;
  return table[key] || null;
}
const MATCHUP_TIPS = {"mid": {"Zed|Ryze": {"posture": "Aggressive", "overall": "Play fast before Ryze stacks items. Trade on W shadow; force kills pre-2 items.", "early": ["Harass on level 3 with W→E→Q.", "Roam on push; deny Ryze from scaling plates."], "mid": ["Dive sides with R when Flash missing.", "Force Herald/Dragon before Seraphs spikes."], "late": ["Avoid 5v5 front-to-back. Look for picks on side lanes."], "youTips": ["Hold R to dodge root; bait Rune Prison then all-in.", "Build lethality tempo; Stopwatch negates his R turn."], "vsTips": ["Buy early armor/Seeker’s vs Zed.", "Respect 6 spike—ward flanks."], "runes": ["Electrocute", "Sudden Impact", "Eyeball", "Ultimate Hunter", "Transcendence", "Scorch"], "start": ["Long Sword + 3 Pots"], "core": ["Prowler's/Eclipse", "Ionian", "Serylda"]}, "Ahri|Yasuo": {"posture": "Neutral", "overall": "Farm safely and punish after Wind Wall. Look for charms from fog.", "early": ["Trade after E down; don’t throw Q into Wind Wall."], "mid": ["Shove then move; pick him when Flash is down."], "late": ["Play with team CC; charm his engage."], "youTips": ["Space diagonally to reduce tornado angles.", "Everfrost root helps secure charm."], "vsTips": ["Don’t waste Wind Wall; track charm cooldown.", "Play with minions to block Q."]}, "Yasuo|Orianna": {"posture": "Aggressive", "overall": "Short trades around shield; punish on W/E cooldowns. Roam on push.", "early": ["All-in at level 2 if she burns shield early."], "mid": ["Split or dive sides when she has no Flash."], "late": ["Look for knockup setups; don’t front-to-back without engage."], "youTips": ["Save Wind Wall for Q+E poke; take early boots."], "vsTips": ["Hug tower on wave 2–3; ping jungle when wall is down."]}, "Yone|Viktor": {"posture": "Neutral", "overall": "Trade when Viktor’s E is down; threaten all-in on his immobility.", "early": ["Crash 3rd wave; take cheater recall."], "mid": ["Flank on objectives; avoid straight chokes vs laser."], "late": ["Side lane; force R on carries then TP."], "youTips": ["Save E return if jungler is near; bait gravity field."], "vsTips": ["Ward side bushes; don’t handshake trades when shield is up."]}, "Akali|Annie": {"posture": "Defensive", "overall": "Respect stun windows; farm and look for post-6 skirmishes.", "early": ["Avoid trading into full stacks; thin waves near tower."], "mid": ["Flank with shroud; don’t face-check wards."], "late": ["Target backline with team CC; avoid front-to-back."], "youTips": ["Buy early MR/Null-Magic; Stopwatch vs Tibbers."], "vsTips": ["Pink shroud and play off stun angle."]}}, "top": {"Renekton|Kayle": {"posture": "Aggressive", "overall": "Punish levels 1–6; dive with jungler on stacked waves.", "early": ["Freeze near tower; trade with 50+ fury.", "Crash cannon and roam/ward."], "mid": ["Force Herald pre-11; deny plates."], "late": ["Avoid extended 5v5—trade sides."], "youTips": ["Anti-heal early; don’t overpush without wards."], "vsTips": ["Respect 6/11 spikes; buy armor and call jungler to break freeze."]}, "Fiora|Ornn": {"posture": "Aggressive", "overall": "Play around vitals; short trades after W. Track his R window.", "early": ["Freeze and punish his CS; call jungle when he uses W."], "mid": ["Pressure side lane; pull TP."], "late": ["Split—avoid 5v5 unless ahead."], "youTips": ["Parry Brittle knockup.", "Hullbreaker side pressure wins map."], "vsTips": ["Stand on covered vital; waveclear safely under tower."]}, "Darius|Camille": {"posture": "Aggressive", "overall": "Short trades and zone with Q; punish her E cooldown.", "early": ["Stack wave and dive with Ghost."], "mid": ["Group when R is ready; force skirmishes."], "late": ["Peel for self; watch for Camille picks."], "youTips": ["Bramble/Plated reduce all-in.", "Don’t chase into walls."], "vsTips": ["Kite out his Ghost; don’t give 5-stack angles."]}, "Jax|Malphite": {"posture": "Aggressive", "overall": "Avoid autos into E; fight on E cooldown. Scale side lane.", "early": ["Crash cannon; deny freezes."], "mid": ["Look for side pick with E+Q."], "late": ["Split and TP flank."], "youTips": ["Early anti-armor shred helps.", "Track his 6—space on waves."], "vsTips": ["Build armor; don’t overextend into E."]}}, "jungle": {"Lee Sin|Master Yi": {"posture": "Aggressive", "overall": "Invade on early prio; fight before Yi’s 2 items.", "early": ["Ward raptors/tri; punish after Q misses."], "mid": ["Force Dragon/Herald on timer."], "late": ["Peel for carries; kick Yi out of fights."], "youTips": ["Track Alpha end to land CC.", "Don’t coinflip 50/50 smites."], "vsTips": ["Avoid early 2v2 without prio; buy anti-heal."]}, "Kayn|Sejuani": {"posture": "Neutral", "overall": "Farm to form; avoid bad 2v2s until spikes.", "early": ["Track lanes with CC; path opposite early pressure."], "mid": ["Contest objectives after form.", "Look for flanks on backline."], "late": ["Front-to-back if Rhaast; picks if Blue."], "youTips": ["Cover lanes with less mobility; ping form timing."], "vsTips": ["Fight before form; ward river and pixel."]}, "Evelynn|Lee Sin": {"posture": "Defensive", "overall": "Avoid early fights; hit 6 and play off fog.", "early": ["Full clear; avoid contesting scuttle without prio."], "mid": ["Pink river; look for charm from fog."], "late": ["Pick side lanes and burst carries."], "youTips": ["Don’t face-check; track sweepers.", "Time Flash + R for executes."], "vsTips": ["Pink river; invade early with prio."]}}, "adc": {"Vayne|Draven": {"posture": "Defensive", "overall": "Avoid early fights; scale to 2 items before taking extended trades.", "early": ["Hug tower; last-hit safely.", "Call jungle for dives only with wave setup."], "mid": ["Play with peel; fight small skirmishes."], "late": ["Side lane and join fights on timers."], "youTips": ["Don’t fight near walls; respect axes.", "Galeforce/PD options depending on comp."], "vsTips": ["Invade and force 2v2s early; deny Vayne plates."]}, "Jinx|Caitlyn": {"posture": "Neutral", "overall": "Respect Cait early; trade back after net or trap used.", "early": ["Farm for items; avoid trap chokes."], "mid": ["Take first tower on rotate; set up vision."], "late": ["Teamfight front-to-back with peels."], "youTips": ["Track chompers positioning.", "RFC/IE 2-item spike powers up picks."], "vsTips": ["Pressure plates early; punish low mobility."]}, "Ezreal|Draven": {"posture": "Defensive", "overall": "Farm with Q; all-in only on E cooldown or with jungle.", "early": ["Tear timing > trades; don’t handshake."], "mid": ["Poke before fights; kite back."], "late": ["Play safe angles; hit front line."], "youTips": ["Sheen buys; early boots.", "Don’t burn E forward without vision."], "vsTips": ["Force trades early; deny tear stacking."]}}, "support": {"Thresh|Lulu": {"posture": "Neutral", "overall": "Look for hook angles from fog; punish shield cooldowns.", "early": ["Brush control; ward lane bushes."], "mid": ["Roam on shove; set vision on river."], "late": ["Peel for carry; pick immobile targets."], "youTips": ["Hexflash angles help; track polymorph."], "vsTips": ["Don’t stand near walls; space vs hook."]}, "Leona|Morgana": {"posture": "Aggressive", "overall": "Force when shield is down; stack wave for all-in.", "early": ["Track black shield; all-in after it expires."], "mid": ["Roam to mid on push; engage from fog."], "late": ["Find flanks; don’t engage without team follow."], "youTips": ["Aftershock timing matters; buy boots early."], "vsTips": ["Save shield for stun; punish long E cooldown."]}, "Nautilus|Janna": {"posture": "Aggressive", "overall": "Engage off cooldowns; deny Janna roams.", "early": ["Hold hook for ADC missteps; ward river."], "mid": ["Dive on stacked waves.", "Clear vision before engages."], "late": ["Flank to avoid peel; backline lock-down."], "youTips": ["Don’t overchase into tornado.", "Engage when ADC can follow."], "vsTips": ["Disengage with R; avoid clumping."]}}};
function scalingSourceLabel(name, lane){
  const ln = (lane||"").toLowerCase();
  if(ROLE_SCALING_DB[name] && ROLE_SCALING_DB[name][ln]) return "role-curated";
  if(SCALING_DB[name]) return "curated";
  return "heuristic";
}
function beginnerMode(){ return !!$("#beginnerToggle")?.checked; }
function postureAdviceText(posture){
  if(beginnerMode()){
    if(posture==="Aggressive") return "You are stronger now. Fight for dragons/herald and pressure towers.";
    if(posture==="Defensive")  return "They are stronger now. Avoid risky fights and farm until your item/level spikes.";
    return "Power is similar. Play around your wave and jungler. Look for safe picks.";
  } else {
    if(posture==="Aggressive") return "You’re stronger now—push pace and fight for objectives.";
    if(posture==="Defensive")  return "They’re stronger now—avoid coinflip fights and trade sides.";
    return "Similar power—play by waves and your jungler’s position.";
  }
}
function postureBullets(posture){
  if(beginnerMode()){
    if(posture==="Aggressive") return ["Contest early objectives.","Trade when your spells are up.","Take plates when safe."];
    if(posture==="Defensive")  return ["Thin waves near tower.","Trade sides on objectives.","Wait for your big items."];
    return ["Clear waves safely.","Roam with jungler for small picks.","Place vision before moving."];
  } else {
    if(posture==="Aggressive") return ["Contest early objectives.","Trade when ahead in tempo.","Take plates and pressure towers."];
    if(posture==="Defensive")  return ["Thin waves near tower.","Trade sides—avoid forced 5v5s.","Wait for level/item spikes."];
    return ["Shove then move first.","Look for picks, not flips.","Fight on your CD windows."];
  }
}
const ROLE_SCALING_DB = {"Kayle": {"top": {"early": 0, "mid": 1, "late": 5}, "mid": {"early": 0, "mid": 2, "late": 4}}, "Malphite": {"top": {"early": 0, "mid": 1, "late": 3}, "mid": {"early": 1, "mid": 2, "late": 2}}, "Morgana": {"support": {"early": 0, "mid": 2, "late": 3}, "jungle": {"early": 1, "mid": 2, "late": 2}}, "Sett": {"top": {"early": 2, "mid": 2, "late": 1}, "support": {"early": 1, "mid": 2, "late": 1}}, "Swain": {"mid": {"early": 0, "mid": 2, "late": 3}, "support": {"early": 0, "mid": 2, "late": 3}}, "Tahm Kench": {"top": {"early": 1, "mid": 2, "late": 2}, "support": {"early": 0, "mid": 1, "late": 2}}, "Kayn": {"jungle": {"early": 1, "mid": 2, "late": 2}}, "Tristana": {"adc": {"early": 2, "mid": 2, "late": 1}, "mid": {"early": 2, "mid": 2, "late": 1}}, "Vladimir": {"mid": {"early": 0, "mid": 1, "late": 4}, "top": {"early": 0, "mid": 1, "late": 4}}, "Pantheon": {"mid": {"early": 3, "mid": 1, "late": 0}, "jungle": {"early": 2, "mid": 1, "late": 0}, "support": {"early": 2, "mid": 1, "late": 0}}, "Karthus": {"mid": {"early": 0, "mid": 2, "late": 3}, "jungle": {"early": 0, "mid": 2, "late": 3}}, "Maokai": {"top": {"early": 1, "mid": 1, "late": 2}, "jungle": {"early": 1, "mid": 2, "late": 2}, "support": {"early": 1, "mid": 2, "late": 2}}, "Gragas": {"top": {"early": 1, "mid": 2, "late": 2}, "mid": {"early": 1, "mid": 2, "late": 2}, "jungle": {"early": 1, "mid": 2, "late": 2}}, "AP Malphite": {"mid": {"early": 1, "mid": 2, "late": 2}}};
function scalingConfidence(name){
  return SCALING_DB[name] ? "curated" : "heuristic";
}
const SCALING_DB = {
  "Aatrox": {
    "early": 1,
    "mid": 2,
    "late": 1
  },
  "Ahri": {
    "early": 1,
    "mid": 2,
    "late": 1
  },
  "Akali": {
    "early": 0,
    "mid": 2,
    "late": 2
  },
  "Akshan": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Alistar": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Amumu": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Anivia": {
    "early": 0,
    "mid": 2,
    "late": 3
  },
  "Annie": {
    "early": 2,
    "mid": 2,
    "late": 1
  },
  "Aphelios": {
    "early": 0,
    "mid": 2,
    "late": 3
  },
  "Ashe": {
    "early": 1,
    "mid": 2,
    "late": 1
  },
  "Aurelion Sol": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Azir": {
    "early": 0,
    "mid": 2,
    "late": 3
  },
  "Bard": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Bel'Veth": {
    "early": 0,
    "mid": 2,
    "late": 3
  },
  "Blitzcrank": {
    "early": 2,
    "mid": 2,
    "late": 0
  },
  "Brand": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Braum": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Briar": {
    "early": 2,
    "mid": 2,
    "late": 0
  },
  "Caitlyn": {
    "early": 2,
    "mid": 1,
    "late": 1
  },
  "Camille": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Cassiopeia": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Cho'Gath": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Corki": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Darius": {
    "early": 2,
    "mid": 2,
    "late": 0
  },
  "Diana": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Dr. Mundo": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Draven": {
    "early": 3,
    "mid": 1,
    "late": 0
  },
  "Ekko": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Elise": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Evelynn": {
    "early": 0,
    "mid": 2,
    "late": 2
  },
  "Ezreal": {
    "early": 0,
    "mid": 2,
    "late": 2
  },
  "Fiddlesticks": {
    "early": 0,
    "mid": 2,
    "late": 3
  },
  "Fiora": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Fizz": {
    "early": 1,
    "mid": 2,
    "late": 1
  },
  "Galio": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Gangplank": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Garen": {
    "early": 2,
    "mid": 1,
    "late": 1
  },
  "Gnar": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Gragas": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Graves": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Gwen": {
    "early": 0,
    "mid": 2,
    "late": 2
  },
  "Hecarim": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Heimerdinger": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Illaoi": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Irelia": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Ivern": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Janna": {
    "early": 0,
    "mid": 1,
    "late": 3
  },
  "Jarvan IV": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Jax": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Jayce": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Jhin": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Jinx": {
    "early": 0,
    "mid": 2,
    "late": 3
  },
  "K'Sante": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Kai'Sa": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Kalista": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Karma": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Karthus": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Kassadin": {
    "early": 0,
    "mid": 1,
    "late": 4
  },
  "Katarina": {
    "early": 0,
    "mid": 2,
    "late": 2
  },
  "Kayle": {
    "early": 0,
    "mid": 1,
    "late": 4
  },
  "Kayn": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Kennen": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Kha'Zix": {
    "early": 2,
    "mid": 2,
    "late": 0
  },
  "Kindred": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Kled": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Kog'Maw": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "LeBlanc": {
    "early": 2,
    "mid": 2,
    "late": 0
  },
  "Lee Sin": {
    "early": 2,
    "mid": 2,
    "late": 0
  },
  "Leona": {
    "early": 2,
    "mid": 2,
    "late": 1
  },
  "Lillia": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Lissandra": {
    "early": 1,
    "mid": 2,
    "late": 1
  },
  "Lucian": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Lulu": {
    "early": 0,
    "mid": 2,
    "late": 3
  },
  "Lux": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Malphite": {
    "early": 0,
    "mid": 1,
    "late": 3
  },
  "Malzahar": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Maokai": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Master Yi": {
    "early": 0,
    "mid": 2,
    "late": 3
  },
  "Milio": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Miss Fortune": {
    "early": 1,
    "mid": 2,
    "late": 1
  },
  "Mordekaiser": {
    "early": 1,
    "mid": 2,
    "late": 1
  },
  "Morgana": {
    "early": 0,
    "mid": 2,
    "late": 2
  },
  "Nami": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Naafiri": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Nasus": {
    "early": 0,
    "mid": 1,
    "late": 3
  },
  "Nautilus": {
    "early": 2,
    "mid": 2,
    "late": 1
  },
  "Neeko": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Nidalee": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Nilah": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Nocturne": {
    "early": 1,
    "mid": 2,
    "late": 1
  },
  "Nunu & Willump": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Olaf": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Orianna": {
    "early": 0,
    "mid": 2,
    "late": 2
  },
  "Ornn": {
    "early": 0,
    "mid": 1,
    "late": 3
  },
  "Pantheon": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Poppy": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Pyke": {
    "early": 2,
    "mid": 2,
    "late": 0
  },
  "Qiyana": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Quinn": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Rakan": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Rammus": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Rek'Sai": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Rell": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Renata Glasc": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Renekton": {
    "early": 3,
    "mid": 1,
    "late": 0
  },
  "Rengar": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Riven": {
    "early": 1,
    "mid": 2,
    "late": 1
  },
  "Rumble": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Ryze": {
    "early": 0,
    "mid": 2,
    "late": 3
  },
  "Samira": {
    "early": 2,
    "mid": 2,
    "late": 0
  },
  "Sejuani": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Senna": {
    "early": 0,
    "mid": 2,
    "late": 2
  },
  "Seraphine": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Sett": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Shaco": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Shen": {
    "early": 1,
    "mid": 2,
    "late": 1
  },
  "Shyvana": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Singed": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Sion": {
    "early": 1,
    "mid": 1,
    "late": 2
  },
  "Sivir": {
    "early": 0,
    "mid": 2,
    "late": 2
  },
  "Skarner": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Sona": {
    "early": 0,
    "mid": 1,
    "late": 3
  },
  "Soraka": {
    "early": 0,
    "mid": 1,
    "late": 3
  },
  "Swain": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Sylas": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Syndra": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Tahm Kench": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Taliyah": {
    "early": 1,
    "mid": 2,
    "late": 1
  },
  "Talon": {
    "early": 2,
    "mid": 2,
    "late": 0
  },
  "Taric": {
    "early": 0,
    "mid": 1,
    "late": 3
  },
  "Teemo": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Thresh": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Tristana": {
    "early": 2,
    "mid": 2,
    "late": 1
  },
  "Trundle": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Tryndamere": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Twisted Fate": {
    "early": 1,
    "mid": 2,
    "late": 1
  },
  "Twitch": {
    "early": 0,
    "mid": 2,
    "late": 3
  },
  "Udyr": {
    "early": 2,
    "mid": 2,
    "late": 1
  },
  "Urgot": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Varus": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Vayne": {
    "early": 0,
    "mid": 2,
    "late": 3
  },
  "Veigar": {
    "early": 0,
    "mid": 1,
    "late": 3
  },
  "Vel'Koz": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Vex": {
    "early": 1,
    "mid": 2,
    "late": 1
  },
  "Vi": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Viego": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Viktor": {
    "early": 0,
    "mid": 2,
    "late": 2
  },
  "Vladimir": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Volibear": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Warwick": {
    "early": 2,
    "mid": 1,
    "late": 0
  },
  "Wukong": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Xayah": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Xerath": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Xin Zhao": {
    "early": 2,
    "mid": 1,
    "late": 0
  },
  "Yasuo": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Yone": {
    "early": 1,
    "mid": 2,
    "late": 2
  },
  "Yorick": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Yuumi": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Zac": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Zed": {
    "early": 2,
    "mid": 2,
    "late": 0
  },
  "Zeri": {
    "early": 0,
    "mid": 2,
    "late": 3
  },
  "Ziggs": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Zilean": {
    "early": 1,
    "mid": 1,
    "late": 1
  },
  "Zoe": {
    "early": 1,
    "mid": 2,
    "late": 1
  },
  "Zyra": {
    "early": 1,
    "mid": 1,
    "late": 1
  }
};
/***** render scaling chart & posture *****/
function renderScalingSection(scale){
  // Badge text + color
  const badge = $("#postureBadge");
  badge.textContent = `Posture: ${scale.posture}`;
  badge.classList.remove("aggressive","neutral","defensive");
  if(scale.posture==="Aggressive") badge.classList.add("aggressive");
  else if(scale.posture==="Defensive") badge.classList.add("defensive");
  else badge.classList.add("neutral");

  // Simple advice line
  $("#postureAdvice").textContent = postureAdviceText(scale.posture);

  // Bullet tips
  const tips = postureBullets(scale.posture);
  $("#postureTips").innerHTML = li(tips);

  // Bar chart (relative within each phase)
  const phases = ["early","mid","late"];
  const labels = {early:"Early", mid:"Mid", late:"Late"};
  let htmlRows = "";
  for(const ph of phases){
    const y = scale.ys[ph]||0, t = scale.ts[ph]||0;
    const maxv = Math.max(1, y, t);
    const yw = Math.round((y / maxv) * 100);
    const tw = Math.round((t / maxv) * 100);
    htmlRows += `
      <div class="scaling-row">
        <div class="label">${labels[ph]}</div>
        <div class="scaling-bars">
          <div class="scaling-bar you" style="width:${yw}%">
            <span class="scaling-num">${y}</span>
          </div>
          <div class="scaling-bar them" style="width:${tw}%">
            <span class="scaling-num">${t}</span>
          </div>
        </div>
      </div>`;
  }
  $("#scalingChart").innerHTML = htmlRows;
}

/***** meta tips for popular champions by role (top-10-ish per lane) *****/
const META_TIPS = {
  top: {
    "Darius": ["Respect level 1 + ghost; keep wave thin near tower to deny all-in.","Track Flash+Ghost timer; call jungler on stacked wave for gank."],
    "Garen": ["Short trades around Q silence; avoid extended when E spinning.","Anti-burst buys (Plated, Bramble) cut his power."],
    "Jax": ["Don’t auto into E; trade on E cooldown; crash cannon to break freezes.","Ward deep for TP flank post-6."],
    "Fiora": ["Stand on covered vitals; only trade after she uses W.","Ping jungler when she overextends for vital procs."],
    "Camille": ["Respect hookshot angles; hold CC for her E landing.","Keep wave on your side; punish post-E cooldowns."],
    "Aatrox": ["Sidestep Q1/Q2 edges; fight after E+W used.","Anti-heal early (Bramble/Executioners) cuts sustain."],
    "Ornn": ["Take cheater recall on cannon; avoid long trades into grasp proc.","Call jungler post-6; he’s immobile without flash."],
    "Malphite": ["Dodge Q slows with minions; avoid building only armor if enemy AP topside.","Track 6 spike—space on waves."],
    "Renekton": ["Respect fury bar; fight when fury <50 and W down.","Early anti-heal reduces all-in threat."],
    "Mordekaiser": ["Fight before 6 or with jungler; build MR if AP heavy.","Buy QSS if you are the key carry target."]
  },
  jungle: {
    "Lee Sin": ["Track level 3 gank path; ward raptor/tri; punish after Q misses.","Don’t handshake early 2v2s if lanes lack prio."],
    "Kayn": ["Track orb color; vs Rhaast avoid extended; vs Blue ward flanks.","Contest form timing with early dragons/heralds."],
    "Master Yi": ["Don’t chain CC early; hold CC for Alpha end; buy early anti-heal.","Deny solo objectives; punish no-flash."],
    "Viego": ["Don’t give resets; fight on vision and peel first target.","Ward pixel/river; fight before 2-item spike."],
    "Kha'Zix": ["Don’t isolate; hug teammates or minions.","Ward raptors & pixel; punish jump cooldown."],
    "Graves": ["Force on him before 2 items; respect kiting.","Ward his raptors/krugs; track Grit stacks."],
    "Evelynn": ["Pink wards in river/pixel; avoid face-checking sides.","Group post-6; sweep fog chokes."],
    "Fiddlesticks": ["Ward raptor/tri blast cones; sweep before objectives.","Interrupt drain; respect fog angles post-6."],
    "Amumu": ["Don’t clump; track double Q angle.","Punish early farm clears; dragon control strong."],
    "Xin Zhao": ["Kite E + R; don’t fight inside his circle.","Early skirmish king—avoid river fights without prio."]
  },
  mid: {
    "Ahri": ["Respect charm angles; fight after E down.","Shove and move first to deny her roam windows."],
    "Yasuo": ["Don’t telegraph projectiles into windwall.","Punish level 1–2 if you have better base stats."],
    "Yone": ["Trade when E down; save CC for return.","Anti-burst + early armor reduces threat."],
    "Zed": ["Stand behind minions for Q; punish W cooldown.","Stopwatch timing denies his R burst."],
    "Sylas": ["Track stolen ults; fight when W on cooldown.","Early anti-heal reduces trades."],
    "Katarina": ["Hold CC for E or R; don’t fight on daggers.","Ping roams; shove + ward sides."],
    "Annie": ["Count stacks; avoid trading into stun.","Respect Tibbers + support roam timers."],
    "Orianna": ["Don’t get poked by ball; fight after W/E used.","Shove then move; she’s immobile pre-flash."],
    "Lux": ["Stand behind minions for Q; punish long CDs.","Respect laser after bind; sweep bushes."],
    "Viktor": ["Avoid poke on waves; trade when E down.","Take early boots; punish immobility pre-augments."]
  },
  adc: {
    "Jinx": ["Respect 2-item spike (RFC+IE); punish pre-2 items.","Track chompers; don’t chase through them."],
    "Kai'Sa": ["Track evolve spikes; don’t give isolate Ws.","Punish before Q evolve; buy early armor if needed."],
    "Ezreal": ["Don’t handshake poke; all-in on E cooldown.","Early shove denies tear stacks."],
    "Caitlyn": ["Avoid traps in choke; fight after net down.","Don’t give plate angles; freeze near tower."],
    "Samira": ["Don’t stack CC for her W/R resets.","Disengage on R; anti-burst helps."],
    "Xayah": ["Respect feather angles; sidestep pullback.","Force R defensively before objective fights."],
    "Miss Fortune": ["Break her E poke with brush control; sidestep R cone.","Fight off-angle so R can’t channel."],
    "Ashe": ["Track arrow; don’t clump for W.","Punish immobility pre-6."],
    "Vayne": ["Don’t fight walls; deny tumbles with minion aggro.","Dive early with jungle help; scales hard."],
    "Draven": ["Don’t trade into spinning axes; drop aggro to reset.","Ward deep to stop cash-in snowball."]
  },
  support: {
    "Thresh": ["Track hook cooldown; path around walls.","Respect flash-flay angles at 6."],
    "Leona": ["Don’t stack aftershock; kite out post-E.","Track hexflash; ward lane brushes."],
    "Nautilus": ["Don’t stand near walls; sidestep hook.","Space out vs point-click R post-6."],
    "Lulu": ["Don’t dive polymorph; fight when W/E down.","Buy anti-shield items if needed."],
    "Nami": ["Sidestep bubble; punish post-spell cooldowns.","All-in when bubble/ult down."],
    "Blitzcrank": ["Brush control = safety; don’t handshake shove into hook.","Buy boots early; stand behind minions."],
    "Morgana": ["Bait shield; CC after it expires.","Punish long Q cooldown; track jungle follow."],
    "Janna": ["Don’t overchase into tornado; dive only with CC chain.","Cut healing; her peel is strong on objectives."],
    "Senna": ["Don’t eat W root; punish soul greed.","Anti-poke items reduce lane bleed."],
    "Alistar": ["Respect headbutt-pulverize angles; disengage on R.","Don’t clump for knockups."]
  }
};
function mergeMetaTips(lane, champName, list, perspective){
  const laneMap = META_TIPS[lane] || {};
  const tips = laneMap[champName];
  if(!tips || !tips.length) return;
  if(perspective === "enemy"){
    for(const t of tips){ list.push(`Vs ${champName}: ${t}`); }
  } else {
    for(const t of tips){ list.push(t); }
  }
}

/***** champ name resolver for common edge cases *****/
const ALIASES = {
  "kaisa":"Kai'Sa",
  "khazix":"Kha'Zix",
  "chogath":"Cho'Gath",
  "velkoz":"Vel'Koz",
  "reksai":"Rek'Sai",
  "dr mundo":"Dr. Mundo",
  "drmundo":"Dr. Mundo",
  "nunu":"Nunu & Willump",
  "nunu and willump":"Nunu & Willump",
  "wukong":"Wukong",
  "monkey king":"Wukong",
  "kogmaw":"Kog'Maw",
  "xinzhao":"Xin Zhao",
  "leesin":"Lee Sin",
  "jarvaniv":"Jarvan IV",
  "jarvan 4":"Jarvan IV",
  "jarvan":"Jarvan IV"
};
function cleanKey(s){
  return String(s||"").toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim();
}
function resolveChamp(input){
  const key = cleanKey(input);
  if(ALIASES[key]) return ALIASES[key];
  for(const c of CHAMPS){
    if(cleanKey(c)===key) return c;
  }
  const candidates = CHAMPS.filter(c=> cleanKey(c).startsWith(key));
  if(candidates.length===1) return candidates[0];
  const contains = CHAMPS.filter(c=> cleanKey(c).includes(key));
  if(contains.length===1) return contains[0];
  return null;
}


/***** Scaling & Posture Helpers *****/
function scoreScaling(profile, lane){
  const p = profile||{};
  const tags = new Set((p.tags||[]).map(t=>t.toLowerCase()));
  const spikes = new Set((p.spikes||[]).map(s=>String(s).toLowerCase()));
  // base buckets
  const s = {early:0, mid:0, late:0};

  // Champion-specific overrides (additive)
  const name = (p.name || p.id || "").toString();
  const o = (SCALING_OVERRIDES[name] || {});
  if(o.early) s.early += o.early;
  if(o.mid)   s.mid   += o.mid;
  if(o.late)  s.late  += o.late;

  // Tag-based heuristics
  if(tags.has("lane-bully")||tags.has("early-gank")||tags.has("roam")) s.early+=2;
  if(tags.has("assassin")||tags.has("burst")||tags.has("pick")||tags.has("engage")||tags.has("skirmish")) s.mid+=2;
  if(tags.has("scaler")||tags.has("dps")||tags.has("control")||tags.has("tank")||tags.has("siege")||tags.has("split")) s.late+=2;

  if(tags.has("juggernaut")||tags.has("bruiser")) { s.mid+=1; s.late+=1; }
  if(tags.has("poke")) { s.mid+=1; }
  if(tags.has("hyper")) { s.late+=2; }

  // Item/level spikes
  if(spikes.has("6")) { s.early+=1; s.mid+=1; }
  if(spikes.has("dirk")||spikes.has("sheen")) s.early+=1;
  if(spikes.has("lost-chapter")) s.early+=1;      // early mana/AP spike
  if(spikes.has("tear")||spikes.has("roa")||spikes.has("archangel")) s.late+=2; // scaling items
  if(spikes.has("2 items")) s.mid+=2;
  if(spikes.has("3 items")) s.late+=2;
  if(spikes.has("form")) s.mid+=1; // Kayn etc.

  s.early=Math.max(0,Math.min(5,s.early)); s.mid=Math.max(0,Math.min(5,s.mid)); s.late=Math.max(0,Math.min(5,s.late)); return s;
}

/***** champion scaling overrides (additive; rough heuristics) *****/
const SCALING_OVERRIDES = {
  // Mid assassins
  "Zed":        { early: 2, mid: 2, late: 0 },
  "Talon":      { early: 2, mid: 2, late: 0 },
  "LeBlanc":    { early: 2, mid: 2, late: 0 },
  "Fizz":       { early: 1, mid: 2, late: 1 },
  // Control/scalers
  "Ryze":       { early: 0, mid: 2, late: 3 },
  "Kassadin":   { early: 0, mid: 1, late: 4 },
  "Veigar":     { early: 0, mid: 1, late: 3 },
  "Viktor":     { early: 0, mid: 2, late: 2 },
  "Orianna":    { early: 0, mid: 2, late: 2 },
  "Azir":       { early: 0, mid: 2, late: 3 },
  "Anivia":     { early: 0, mid: 2, late: 3 },
  "Syndra":     { early: 1, mid: 2, late: 2 },
  "Ahri":       { early: 1, mid: 2, late: 1 },
  "Annie":      { early: 2, mid: 2, late: 1 },
  "Ekko":       { early: 1, mid: 2, late: 2 },
  "Diana":      { early: 1, mid: 2, late: 2 },
  "Yone":       { early: 1, mid: 2, late: 2 },
  "Yasuo":      { early: 1, mid: 2, late: 2 }
};

function compareScaling(you, them, lane){
  const ys = scoreScaling(you, lane), ts = scoreScaling(them, lane);
  const diff = { early: ys.early - ts.early, mid: ys.mid - ts.mid, late: ys.late - ts.late };

  // If both profiles are empty (all zeros), treat as neutral
  const ySum = ys.early+ys.mid+ys.late, tSum = ts.early+ts.mid+ts.late;
  if(ySum===0 && tSum===0) return { ys, ts, diff, posture: "Neutral", stageText: "even" };

  // Weighted sum (mid > late > early); smaller threshold for confidence
  const sum = 1.0*diff.early + 1.3*diff.mid + 1.2*diff.late;
  let posture = "Neutral";
  if(sum >= 2.5) posture = "Aggressive";
  else if(sum <= -2.5) posture = "Defensive";

  // Dominant stage text
  if((you?.name||"") === (them?.name||"")) posture = "Neutral";
  const stageEdge = Object.entries(diff).sort((a,b)=>Math.abs(b[1]) - Math.abs(a[1]))[0];
  const stageText = `${stageEdge[0]} ${stageEdge[1] > 0 ? "advantage" : (stageEdge[1]<0?"disadvantage":"even")}`;
  return { ys, ts, diff, posture, stageText };
}
function roleTips(lane, you, them){
  const out = [];
  if(lane==="jungle"){
    out.push("Path toward prio; track enemy start via leash @0:50 and cross/mirror smartly.");
    out.push("Health > speed on first clear; contest scuttle only with lane prio.");
    out.push("Trade objectives when outscaled. Hover cannon crashes for dive timers.");
  }
  if(lane==="support"){
    out.push("Sync trades with ADC CDs/sums. Win level 2 race; ward river on shove.");
    out.push("Roam mid on good shove; buy Control Wards every base to own brush control.");
  }
  if(lane==="top"){ out.push("Freeze near tower vs melee; crash cannon to recall."); }
  if(lane==="mid"){ out.push("Shove → move first; ward opposite jungler side."); }
  if(lane==="adc"){ out.push("Position by threat lines; trade when support can chain CC/peel."); }
  (you.tips?.early||[]).slice(0,2).forEach(t=> out.push(`Your champ: ${t}`));
  (them.tips?.early||[]).slice(0,1).forEach(t=> out.push(`Vs ${them.name||"enemy"}: ${t}`));
  return out;
}

/* ===== utilities ===== */
const $ = s => document.querySelector(s);
const esc = s => String(s).replace(/[&<>"']/g, c=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[c]));
const tag = t => `<span class="tag">${esc(t)}</span>`;
const tags = a => a.map(tag).join(" ");
const li = a => a.map(x=>`<li>${esc(x)}</li>`).join("");
function setStatus(s){ $("#status").textContent = s; }
function uniq(arr){ return [...new Set((arr||[]).filter(Boolean))]; }

/* ===== typeahead binder ===== */
function bindPicker(inputId, listId, src){
  const inp = $(inputId), list = $(listId);
  function renderOpts(){
    const q = inp.value.trim().toLowerCase();
    const data = src.filter(n => !q || cleanKey(n).includes(cleanKey(q)));
    list.innerHTML = data.map(n=>`<div class="opt" data-v="${n}">${n}</div>`).join("");
    list.style.display = data.length ? "block" : "none";
    Array.from(list.children).forEach(n => n.onclick = ()=>{ inp.value = n.dataset.v; list.style.display="none"; saveLast(); });
  }
  inp.addEventListener("input", renderOpts);
  inp.addEventListener("focus", renderOpts);
  document.addEventListener("click", e => { if(!list.contains(e.target) && e.target!==inp) list.style.display="none"; });
}

/***** champions (typeahead source) *****/
const CHAMPS = [
  "Aatrox","Ahri","Akali","Akshan","Alistar","Amumu","Anivia","Annie","Aphelios","Ashe","Aurelion Sol","Azir","Bard","Bel'Veth","Blitzcrank","Brand","Braum","Briar",
  "Caitlyn","Camille","Cassiopeia","Cho'Gath","Corki","Darius","Diana","Dr. Mundo","Draven","Ekko","Elise","Evelynn","Ezreal","Fiddlesticks","Fiora","Fizz","Galio","Gangplank","Garen","Gnar","Gragas","Graves","Gwen",
  "Hecarim","Heimerdinger","Illaoi","Irelia","Ivern","Janna","Jarvan IV","Jax","Jayce","Jhin","Jinx","K'Sante","Kai'Sa","Kalista","Karma","Karthus","Kassadin","Katarina","Kayle","Kayn","Kennen","Kha'Zix","Kindred","Kled","Kog'Maw",
  "LeBlanc","Lee Sin","Leona","Lillia","Lissandra","Lucian","Lulu","Lux","Malphite","Malzahar","Maokai","Master Yi","Milio","Miss Fortune","Mordekaiser","Morgana","Nami","Naafiri","Nasus","Nautilus","Neeko","Nidalee","Nilah","Nocturne","Nunu & Willump",
  "Olaf","Orianna","Ornn","Pantheon","Poppy","Pyke","Qiyana","Quinn","Rakan","Rammus","Rek'Sai","Rell","Renata Glasc","Renekton","Rengar","Riven","Rumble","Ryze","Samira","Sejuani","Senna","Seraphine","Sett","Shaco","Shen","Shyvana","Singed","Sion","Sivir","Skarner","Sona","Soraka","Swain",
  "Sylas","Syndra","Tahm Kench","Taliyah","Talon","Taric","Teemo","Thresh","Tristana","Trundle","Tryndamere","Twisted Fate","Twitch","Udyr","Urgot","Varus","Vayne","Veigar","Vel'Koz","Vex","Vi","Viego","Viktor","Vladimir","Volibear","Warwick","Wukong","Xayah","Xerath","Xin Zhao","Yasuo","Yone","Yorick","Yuumi","Zac","Zed","Zeri","Ziggs","Zilean","Zoe","Zyra"
];

/***** lane baselines (SR) *****/
const LANE_DEFAULTS = {
  top:{sum:["Flash","Teleport"], runes:["Conqueror","Triumph","Legend: Alacrity","Last Stand","Bone Plating","Overgrowth"],
       start:["Doran's Blade/Shield"], core:["Armor/MR boots","Bruiser mythic","Black Cleaver"], sit:["Executioner's","Bramble","Randuin's"], skills:"Max main damage → utility"},
  jungle:{sum:["Smite","Flash"], runes:["Conqueror","Triumph","Legend: Tenacity","Coup de Grace","Magical Footwear","Cosmic Insight"],
       start:["Jungle item","Refillable"], core:["Mythic","Boots","Damage/utility mix"], sit:["Stopwatch","Anti-heal","MR/Armor"], skills:"Max clear or gank tool"},
  mid:{sum:["Flash","Teleport"], runes:["Electrocute/First Strike","Taste of Blood","Eyeball Collection","Ultimate Hunter","Manaflow Band","Transcendence"],
       start:["Doran's Ring/Corrupting"], core:["Luden's/Liandry's/Everfrost","Sorcerer Boots","Shadowflame/Zhonya's"], sit:["Banshee's","Morello","Void Staff"], skills:"Max Q → W → E (most mages)"},
  adc:{sum:["Flash","Heal/Cleanse"], runes:["Lethal Tempo","Presence of Mind","Legend: Bloodline","Coup de Grace","Taste of Blood","Treasure Hunter"],
       start:["Doran's Blade"], core:["Mythic ADC","Berserker's","RFC/PD/IE"], sit:["QSS","GA","BT","Wit's End"], skills:"Max primary DPS spell"},
  support:{sum:["Flash","Ignite/Exhaust"], runes:["Guardian/Aftershock/Aery","Font of Life","Bone Plating","Revitalize","Biscuit Delivery","Cosmic Insight"],
       start:["Support item","2 Pots"], core:["Boots","Mythic support","Redemption/Mikael"], sit:["Anathema's","Zeke's","Chemtech Putrifier"], skills:"Max poke/heal or engage"}
};

/***** PROFILES (seeded & expanded) *****/
/* NOTE: To keep the single-file size reasonable, profiles are expanded for ~80+ high-pick champs.
   ALL champions are still supported via lane baselines + generator so you never get empty advice.
   You can add/extend any champ here later with the same schema. */
const PROFILES = {
  /* Mids (examples) */
  "Ahri":{ role:["mid"], tags:["ranged","pick","burst","mobility","cc","wave","spikes-6"], weak:["mana-early","skillshots","vs-heavy-shield","vs-hard-cc"],
    spikes:["6","lost-chapter"], skills:"Max Q > W > E",
    runes:["Electrocute","Taste of Blood","Eyeball","Ultimate Hunter","Transcendence","Scorch"],
    start:["Doran's Ring + Pot"], core:["Luden's","Sorcerer's","Shadowflame"], sit:["Seeker's","Banshee's","Zhonya's","Morello"],
    tips:{ early:["Stand behind minions to reduce skillshots.","Trade on Q return; hold Charm for dashes."],
           mid:["Roam after shove using R charges.","Fish Charm first from fog."],
           late:["Pick around vision; save 1 R to exit.","Charm as peel vs divers."] } },
  "Zed":{ role:["mid"], tags:["melee","assassin","burst","mobility","allin","spikes-6"], weak:["vs-armor","vs-point-cc","wave-early"],
    spikes:["6","dirk"], skills:"Max Q > E > W",
    runes:["Electrocute","Sudden Impact","Eyeball","Ultimate Hunter","Transcendence","Scorch"],
    start:["Long Sword + 3 Pots"], core:["Eclipse/Prowler's","Ionian","Serylda"], sit:["Edge of Night","GA","Maw","Serpent's Fang"],
    tips:{ early:["Trade after W used; stand behind minions to cut Q."], mid:["Seeker's/Plated flips his all-in."], late:["Exhaust/peel his re-engage after R."] } },
  "Lux":{ role:["mid","support"], tags:["ranged","poke","pick","burst","wave"], weak:["vs-gapclose","squishy","mana-early"],
    spikes:["lost-chapter","6"], skills:"Max E > Q > W",
    runes:["First Strike","Manaflow","Transcendence","Scorch","Biscuit","Cosmic Insight"],
    start:["Doran's Ring + Pot"], core:["Luden's","Sorcerer's","Horizon"], sit:["Zhonya's","Banshee's","Morello"],
    tips:{ early:["Don’t stand in your own caster line vs E+Q."], mid:["Shove & move; hide E casts in fog."], late:["Fish picks; peel vs divers."] } },
  "Fizz":{ role:["mid"], tags:["melee","assassin","burst","mobility","untargetable","spikes-6"], weak:["wave-early","vs-armor","vs-point-cc"],
    spikes:["6"], skills:"Max E > W > Q",
    runes:["Electrocute","Sudden","Eyeball","Treasure","Transcendence","Scorch"],
    start:["Doran's Shield","Corrupting"], core:["Lich Bane","Sorcerer's","Zhonya's"], sit:["Seeker's","Banshee's","Void"],
    tips:{ early:["Hold CC until after he uses E."], mid:["Hide behind minions to reduce R connect."], late:["Group; bait E with soft engage."] } },
  "Yasuo":{ role:["mid","top"], tags:["melee","skirmisher","dps","mobility","windwall"], weak:["vs-point-cc","pre-crit"], spikes:["2 items"], skills:"Max Q > E > W",
    runes:["Lethal Tempo","Triumph","Alacrity","Last Stand","Bone Plating","Overgrowth"],
    start:["Doran's Blade"], core:["Shieldbow","Berserker's","Infinity Edge"], sit:["Wit's End","Death's Dance","GA","Randuin's"],
    tips:{ early:["Pop flow shield; then trade."], mid:["Don’t fight in big waves where he dashes freely."], late:["Peel; deny knockup chains."] } },
  "Yone":{ role:["mid","top"], tags:["melee","assassin","dps","mobility"], weak:["vs-point-cc","pre-2item"], spikes:["2 items"], skills:"Max Q > E > W",
    runes:["Lethal Tempo","Triumph","Alacrity","Last Stand","Bone Plating","Overgrowth"],
    start:["Doran's Shield/Blade"], core:["Shieldbow","Berserker's","IE/Bloodthirster"], sit:["Wit's End","GA","Randuin's"],
    tips:{ early:["Short trades; punish on E return."], mid:["Tabi/Randuin's flips fights."], late:["Kill on E return if he overcommits."] } },

  /* Tops (sample subset; more below via Object.assign) */
  "Darius":{ role:["top"], tags:["melee","juggernaut","allin","snowball","dps"], weak:["kite","range","cc"], spikes:["6"], skills:"Max Q > E > W",
    runes:["Conqueror","Triumph","Alacrity","Last Stand","Bone Plating","Overgrowth"],
    start:["Doran's Blade/Shield"], core:["Stridebreaker","Plated","Dead Man's"], sit:["Executioner's","Randuin's","Thornmail"],
    tips:{ early:["Hold wave near your side; Q edge heals—deny it."], mid:["Armor+kiting tools blunt him."], late:["Peel carries; don’t let him stack."] } },
  "Garen":{ role:["top"], tags:["juggernaut","silence","execute"], weak:["kite","antiheal"], spikes:["6"], skills:"Max E > Q > W",
    runes:["Conqueror/Phase Rush","Triumph","Alacrity","Coup","Second Wind","Unflinching"],
    start:["Doran's Shield"], core:["Stridebreaker","Plated","Dead Man's"], sit:["Executioner's","Randuin's","Anathema's"],
    tips:{ early:["Short trades; avoid Q→E full duration."], mid:["Cut healing to stop passive."], late:["Kite; avoid silence on clumps."] } },

  /* Jung/ADC/Support quick seeds (more below via Object.assign) */
  "Lee Sin":{ role:["jungle"], tags:["early-gank","skirmish","mobility"], weak:["scales-poor","cc-chains"], spikes:["Dirk","Goredrinker"], skills:"Max Q > W > E",
    runes:["Conqueror","Triumph","Tenacity","Last Stand","Magical Footwear","Cosmic"], start:["Jungle item"],
    core:["Goredrinker","Plated","Black Cleaver"], sit:["GA","Maw","Edge of Night"],
    tips:{ early:["Expect lvl3 gank; ward tri/raptors."], mid:["Track flashes for kick plays."], late:["Peel or pick—don’t front-to-back."] } },
  "Caitlyn":{ role:["adc"], tags:["ranged","lane-bully","siege","trap"], weak:["vs-hard-engage"], spikes:["2 items"], skills:"Max Q > W > E",
    runes:["Lethal Tempo","Presence","Alacrity","Coup","Taste of Blood","Treasure Hunter"],
    start:["Doran's Blade"], core:["Galeforce","Berserker's","RFC"], sit:["QSS","GA","BT"],
    tips:{ early:["Shove for plates; trap brush."], mid:["Siege mid; net defensively."], late:["Front-to-back; keep max range."] } },
  "Leona":{ role:["support"], tags:["engage","point-cc","tank"], weak:["poke","disengage"], spikes:["2","6"], skills:"Max E > W > Q",
    runes:["Aftershock","Font","Bone Plating","Unflinching","Biscuit","Cosmic"], start:["Relic"],
    core:["Locket","Mercs","Knight's Vow"], sit:["Zeke's","Anathema's","Mikael's"],
    tips:{ early:["Engage only when ADC can follow."], mid:["Flank with sweeper."], late:["Peel divers if behind."] } }
};

/* — Merge: Chunk 1/3 tops+mids we sent earlier — */
Object.assign(PROFILES, {
  "Aatrox":{ role:["top"], tags:["melee","drain","bruiser","allin","aoe"], weak:["grievous","kite","cc"], spikes:["Goredrinker","2 items"], skills:"Max Q > E > W",
    runes:["Conqueror","Triumph","Tenacity","Last Stand","Second Wind","Unflinching"], start:["Doran's Shield"],
    core:["Goredrinker","Plated/Mercs","Black Cleaver"], sit:["Executioner's","Death's Dance","Thornmail"],
    tips:{ early:["Respect Q sweet spots; punish missed Q1."], mid:["Kite E/Q chain; avoid long waves."], late:["Peel and burst during W CD."] } },
  "Renekton":{ role:["top"], tags:["diver","lane-bully","stun"], weak:["scales-poor","kite","armor"], spikes:["Stride/Black Cleaver"], skills:"Max Q > E > W",
    runes:["Conqueror","Triumph","Alacrity","Last Stand","Bone Plating","Overgrowth"], start:["Doran's Blade"],
    core:["Stridebreaker","Plated","Black Cleaver"], sit:["Executioner's","Death's Dance","GA"],
    tips:{ early:["Avoid fury empowered W windows."], mid:["Armor + kiting flips fights."], late:["Force 5v5; deny side picks."] } },
  "Riven":{ role:["top"], tags:["mobility","bruiser","cc"], weak:["cc-chains","grievous","exhaust"], spikes:["2 items"], skills:"Max Q > E > W",
    runes:["Conqueror","Triumph","Tenacity","Last Stand","Bone Plating","Overgrowth"], start:["Doran's Blade"],
    core:["Ravenous","CDR boots","Death's Dance"], sit:["Plated","Randuin's","Executioner's"],
    tips:{ early:["Trade after she uses E; watch Q3 knockup."], mid:["Ward flanks; stopwatch ruins burst."], late:["Exhaust/peel for R+flash."] } },
  "Jax":{ role:["top"], tags:["duelist","split","dodge"], weak:["aoe","kiting","pre-6"], spikes:["Sheen","2 items"], skills:"Max W > E > Q",
    runes:["Conqueror","Triumph","Alacrity","Last Stand","Bone Plating","Overgrowth"], start:["Doran's Blade"],
    core:["Trinity","Bork","Plated/Mercs"], sit:["Randuin's","Frozen Heart","Thornmail"],
    tips:{ early:["Don’t auto during E; punish after."], mid:["Avoid isolated 1v1s if behind."], late:["Kite; don’t 1v1 3-item spike."] } },
  "Irelia":{ role:["top","mid"], tags:["dashes","healing","allin"], weak:["grievous","cc-chains","thin-wave"], spikes:["Sheen","2 items"], skills:"Max Q > W > E",
    runes:["Conqueror","Triumph","Alacrity","Last Stand","Bone Plating","Overgrowth"], start:["Doran's Blade"],
    core:["Trinity","Bork","Wit's End"], sit:["Executioner's","Randuin's","Frozen Heart"],
    tips:{ early:["Thin wave to deny Q resets; punish missed E."], mid:["Apply grievous; don’t fight on stacked waves."], late:["Peel back; kite through slows."] } },
  "Sett":{ role:["top"], tags:["juggernaut","true-dmg","shield"], weak:["poke","kite","grievous"], spikes:["Stride/Titanic"], skills:"Max Q > W > E",
    runes:["Conqueror","Triumph","Tenacity","Last Stand","Bone Plating","Overgrowth"], start:["Doran's Blade/Shield"],
    core:["Stridebreaker","Titanic","Plated"], sit:["Executioner's","Randuin's","Thornmail"],
    tips:{ early:["Don’t stand in W true-damage cone; bait it."], mid:["Kite Q MS; deny Hexflash angles."], late:["Save displacement for R engage."] } },
  "Mordekaiser":{ role:["top"], tags:["ap-fighter","drain","realm"], weak:["kite","range","qss"], spikes:["Rylai","2 items"], skills:"Max Q > E > W",
    runes:["Conqueror","Triumph","Tenacity","Last Stand","Bone Plating","Overgrowth"], start:["Doran's Shield"],
    core:["Rylai","Liandry","Plated/Mercs"], sit:["QSS","Morello","Wit's End"],
    tips:{ early:["Stand off wave to dodge E pull; trade after W."], mid:["QSS vs R on carries; group deny isolate."], late:["Peel the realm target on exit."] } },
  "Nasus":{ role:["top"], tags:["scaler","siphon","anti-ad"], weak:["early-bully","freeze","range"], spikes:["2 items"], skills:"Max Q > W > E",
    runes:["Fleet","Presence","Alacrity","Cut Down","Second Wind","Unflinching"], start:["Doran's Shield"],
    core:["Trinity/Frozen Heart","Plated","Sunderer"], sit:["Executioner's","Anathema's","Thornmail"],
    tips:{ early:["Freeze 6–8 minions; punish last hits with jungler."], mid:["Kite Wither; don’t overchase."], late:["Force 5v5; deny split."] } },
  "Yorick":{ role:["top"], tags:["split","ghouls","siege"], weak:["aoe","disengage","group"], spikes:["Hullbreaker"], skills:"Max Q > E > W",
    runes:["Conqueror","Triumph","Alacrity","Last Stand","Bone Plating","Overgrowth"], start:["Doran's Blade"],
    core:["Trinity","Hullbreaker","Plated"], sit:["Tiamat/AoE","Randuin's","Thornmail"],
    tips:{ early:["Kill maiden first; avoid cage chases."], mid:["Group mid to break side pressure."], late:["Collapse when maiden down; punish TP."] } },
  "Urgot":{ role:["top"], tags:["ranged-melee","execution","tank-dps"], weak:["kite","poke-ap","range"], spikes:["Black Cleaver"], skills:"Max W > E > Q",
    runes:["Conqueror","Triumph","Tenacity","Last Stand","Bone Plating","Overgrowth"], start:["Doran's Blade"],
    core:["Black Cleaver","Titanic","Plated"], sit:["Randuin's","Thornmail","Anathema's"],
    tips:{ early:["Respect E flash; deny shotgun leg angles."], mid:["Don’t hug; zone him off close range."], late:["Save displacement for execute pull."] } },
  "Kennen":{ role:["top","mid"], tags:["poke-ap","aoe-stun","engage"], weak:["vs-tanks-late","poke-sustain"], spikes:["6","2 items"], skills:"Max Q > W > E",
    runes:["First Strike/Electrocute","Manaflow","Transcendence","Scorch","Biscuit","Cosmic"], start:["Doran's Blade/Ring"],
    core:["Rocketbelt","Sorcs","Zhonya's"], sit:["Banshee's","Morello","Shadowflame"],
    tips:{ early:["Punish last hits with Q; respect E gap."], mid:["Flank wards for multi-man R."], late:["Spread in choke; stopwatch denies engage."] } },
  "Jayce":{ role:["top","mid"], tags:["poke-ad","burst","siege"], weak:["vs-engage","mana-early"], spikes:["Dirk","2 items"], skills:"Max Q > E > W",
    runes:["First Strike","Manaflow","Transcendence","Scorch","Biscuit","Cosmic"], start:["Long Sword 3 Pots/Doran's"],
    core:["Youmuu's","Manamune","Serylda"], sit:["GA","Maw","Edge of Night"],
    tips:{ early:["Brush control; EQ tap then disengage."], mid:["Siege then rotate; avoid coinflip engage."], late:["Peel & poke; no facechecks."] } },
  "Quinn":{ role:["top"], tags:["ranged","roam","burst"], weak:["hard engage","tanks","cc"], spikes:["6","Dirk"], skills:"Max Q > W > E",
    runes:["Fleet","Presence","Alacrity","Cut Down","Bone Plating","Overgrowth"], start:["Doran's Blade"],
    core:["Youmuu's","Collector","Berserker's"], sit:["GA","Maw","Black Cleaver"],
    tips:{ early:["Abuse range; blind last hits then back off."], mid:["Roam on R timers—shove then move."], late:["Flank picks; avoid front-to-back vs tanks."] } },
  "Tryndamere":{ role:["top"], tags:["split","crit","sustain"], weak:["cc","kite","exhaust"], spikes:["2 items"], skills:"Max Q > E > W",
    runes:["Lethal Tempo","Triumph","Alacrity","Last Stand","Second Wind","Unflinching"], start:["Doran's Shield"],
    core:["Kraken","Navori","Berserker's"], sit:["Randuin's","Frozen Heart","Executioner's"],
    tips:{ early:["Don’t long trade on fury; thin wave."], mid:["Save CC for post-R; kite."], late:["Avoid side 1v1; force grouped."] } },
  "Kled":{ role:["top"], tags:["skirmisher","mount","allin"], weak:["poke","kite","disengage"], spikes:["6","2 items"], skills:"Max Q > W > E",
    runes:["Conqueror","Triumph","Alacrity","Last Stand","Bone Plating","Overgrowth"], start:["Doran's Blade"],
    core:["Titanic","Black Cleaver","Plated"], sit:["Executioner's","Randuin's","GA"],
    tips:{ early:["Punish remount timers; avoid pocket pistol angles."], mid:["Peel R path; pre-ward lanes."], late:["CC chains stop remount—kite back."] } },
  "Illaoi":{ role:["top"], tags:["juggernaut","aoe","zone","split"], weak:["disengage","burst","cc"], spikes:["Sheen","2 items"], skills:"Max E > Q > W",
    runes:["Conqueror","Triumph","Tenacity","Last Stand","Bone Plating","Overgrowth"], start:["Doran's Shield"],
    core:["Black Cleaver","Sterak's","Plated"], sit:["Executioner's","Anathema's","Randuin's"],
    tips:{ early:["Don’t fight under tentacles; respect E pull."], mid:["Clear tentacles before fights."], late:["Kite R zone; drag out to open."] } },
  "Shen":{ role:["top"], tags:["tank","global","taunt"], weak:["poke","split pressure"], spikes:["6","Sunfire"], skills:"Max Q > E > W",
    runes:["Grasp","Shield Bash","Bone Plating","Overgrowth","Biscuit","Cosmic"], start:["Doran's Shield"],
    core:["Sunfire","Mercs","Knight's Vow"], sit:["Anathema's","Thornmail","Randuin's"],
    tips:{ early:["Short trades around sword recall."], mid:["Track R; ping cross-map."], late:["Taunt divers; peel carry."] } },
  "Sion":{ role:["top"], tags:["tank","engage","push-die"], weak:["sustain-poke","anti-tank"], spikes:["Heartsteel"], skills:"Max Q > W > E",
    runes:["Grasp","Demolish","Bone Plating","Overgrowth","Biscuit","Cosmic"], start:["Doran's Shield"],
    core:["Heartsteel","Plated","Thornmail"], sit:["Anathema's","FoN","Randuin's"],
    tips:{ early:["Side-step Q; poke while shield down."], mid:["Don’t overchase zombie form."], late:["Spread vs R; ward long flanks."] } },
  "Ornn":{ role:["top"], tags:["tank","engage","forge"], weak:["poke","range","split"], spikes:["Sunfire","Frozen Heart"], skills:"Max W > Q > E",
    runes:["Grasp","Demolish","Bone Plating","Overgrowth","Biscuit","Cosmic"], start:["Doran's Shield"],
    core:["Sunfire","Frozen Heart","Mercs"], sit:["Anathema's","Thornmail","FoN"],
    tips:{ early:["Punish after W brittle proc."], mid:["Don’t fight in narrow chokes."], late:["Save dash for second horn call."] } },
  "Cho'Gath":{ role:["top","mid"], tags:["tank","true-exec","silence","knockup"], weak:["poke","kiting"], spikes:["6"], skills:"Max E > Q > W",
    runes:["Grasp","Demolish","Bone Plating","Overgrowth","Biscuit","Cosmic"], start:["Doran's Shield"],
    core:["Sunfire","Thornmail","FoN"], sit:["Anathema's","Gargoyle","Frozen Heart"],
    tips:{ early:["Dodge Q; trade after silence."], mid:["Contest early objs to limit feast stacks."], late:["Space outside feast; burst Gargoyle first."] } },
  "Rumble":{ role:["top","mid"], tags:["ap-bruiser","zone","aoe","push"], weak:["heat mgmt","poke-ap"], spikes:["6","Liandry"], skills:"Max Q > E > W",
    runes:["First Strike","Manaflow","Transcendence","Scorch","Biscuit","Cosmic"], start:["Doran's Shield"],
    core:["Liandry","Sorcs","Demonic"], sit:["Zhonya's","Morello","Banshee's"],
    tips:{ early:["Punish overheat; avoid extended Q if losing."], mid:["Don’t fight in Equalizer chokes."], late:["Stopwatch vs catch; ward flanks."] } },

  /* a few popular mids from chunk 1 */
  "Anivia":{ role:["mid"], tags:["control","wall","zone","wave"], weak:["mobility","poke"], spikes:["Lost Chapter","2 items"], skills:"Max E > Q > W",
    runes:["First Strike","Manaflow","Transcendence","Scorch","Biscuit","Cosmic"], start:["Doran's Ring"],
    core:["Liandry","Archangel","Rylai"], sit:["Zhonya's","Banshee's","Morello"],
    tips:{ early:["Don’t overcommit to crack egg alone."], mid:["Fight in open space, not chokes."], late:["Siege denial—split or engage early."] } },
  "Annie":{ role:["mid","support"], tags:["burst","stun","point-click"], weak:["range","poke"], spikes:["6","Luden"], skills:"Max Q > W > E",
    runes:["Electrocute","Taste","Eyeball","Ultimate Hunter","Manaflow","Transcendence"], start:["Doran's Ring"],
    core:["Luden","Sorcs","Shadowflame"], sit:["Banshee's","Zhonya's","Morello"],
    tips:{ early:["Count stun stacks; avoid Tibbers setups."], mid:["Spread vs Tibbers engage."], late:["Track flash; stopwatch if threatened."] } },
  "Azir":{ role:["mid"], tags:["control","dps","soldiers"], weak:["cc","divers","mana-early"], spikes:["Nashor","2 items"], skills:"Max W > Q > E",
    runes:["Lethal Tempo/First Strike","Manaflow","Transcendence","Scorch","Biscuit","Cosmic"], start:["Doran's Ring"],
    core:["Nashor","Liandry","Sorcs"], sit:["Zhonya's","Banshee's","Morello"],
    tips:{ early:["Punish mana; avoid shuffle wall."], mid:["Kill soldiers or disengage."], late:["Front-to-back; stopwatch vs shuffle."] } },
  "Orianna":{ role:["mid"], tags:["control","shield","wombo"], weak:["divers","poke-ap"], spikes:["Lost Chapter","2 items"], skills:"Max Q > W > E",
    runes:["First Strike","Manaflow","Transcendence","Scorch","Biscuit","Cosmic"], start:["Doran's Ring"],
    core:["Luden/Liandry","Sorcs","Shadowflame"], sit:["Zhonya's","Banshee's","Morello"],
    tips:{ early:["Trade around ball; bait shield CD."], mid:["Don’t clump; track flash+R."], late:["Peel; front-to-back."] } }
});

/* — Merge: Chunk 2/3 junglers (subset representative for full function) — */
Object.assign(PROFILES, {
  "Jarvan IV":{ role:["jungle"], tags:["gank","engage","aoe"], weak:["kite","disengage"], spikes:["2","6"], skills:"Max Q > E > W",
    runes:["Conqueror","Triumph","Tenacity","Last Stand","Magical Footwear","Cosmic"], start:["Jungle item"],
    core:["Goredrinker","Plated/Mercs","Black Cleaver"], sit:["GA","Randuin's","Thornmail"],
    tips:{ early:["Ward river/tri @2:45; EQ flash angles."], mid:["Place wards over Cataclysm walls."], late:["Peel or engage; don’t trap allies in R."] } },
  "Vi":{ role:["jungle"], tags:["point-ult","single-target","engage"], weak:["kite","peel","exhaust"], spikes:["6","2 items"], skills:"Max Q > E > W",
    runes:["Conqueror","Triumph","Tenacity","Last Stand","Magical Footwear","Cosmic"], start:["Jungle item"],
    core:["Sunderer","Black Cleaver","Plated/Mercs"], sit:["GA","Maw","Randuin's"],
    tips:{ early:["Ward Q wall paths."], mid:["Peel carry from her R with CC."], late:["Bait R onto tank if needed."] } },
  "Viego":{ role:["jungle"], tags:["reset","skirmish","assassin"], weak:["cc","vision"], spikes:["2 items"], skills:"Max Q > E > W",
    runes:["Conqueror","Triumph","Tenacity","Last Stand","Magical Footwear","Cosmic"], start:["Jungle item"],
    core:["Kraken/Sunderer","Berserker's/Mercs","Bork"], sit:["GA","Randuin's","Wit's End"],
    tips:{ early:["Don’t give first reset; kite out."], mid:["Zone corpses to deny possession."], late:["Burst before first reset."] } },
  "Kayn":{ role:["jungle"], tags:["transform"], weak:["pre-form","vision"], spikes:["form","2 items"], skills:"Max Q > W > E",
    runes:["Conqueror/First Strike","Triumph","Tenacity","Last Stand","Magical Footwear","Cosmic"], start:["Jungle item"],
    core:["Goredrinker/Youmuu's","Muramana (blue)","Plated/Mercs"], sit:["GA","Maw","Randuin's"],
    tips:{ early:["Deny form stacks (ranged for Blue, melee for Red)."], mid:["Ward walls; track E glides."], late:["Peel vs Blue; anti-heal vs Rhaast."] } },
  "Kha'Zix":{ role:["jungle"], tags:["isolate","assassin","pick"], weak:["group","vision","armor"], spikes:["Dirk","6","E evolve"], skills:"Max Q > W > E",
    runes:["First Strike/Electrocute","Sudden","Eyeball","Treasure","Transcendence","Scorch"], start:["Jungle item"],
    core:["Youmuu's","Serylda","Ionian"], sit:["Edge of Night","GA","Maw"],
    tips:{ early:["Deny isolation; hug allies/wards."], mid:["Track E reset; kite after leap."], late:["Group and sweep."] } },
  "Sejuani":{ role:["jungle"], tags:["tank","cc","engage"], weak:["kite","grievous"], spikes:["6","Sunfire"], skills:"Max W > Q > E",
    runes:["Aftershock","Font","Bone Plating","Unflinching","Biscuit","Cosmic"], start:["Jungle item"],
    core:["Sunfire","Mercs","Knight's Vow"], sit:["Anathema's","Thornmail","FoN"],
    tips:{ early:["Respect ganks with melee laners."], mid:["Spread vs R; mercs/cleanse help."], late:["Frontline; don’t overchase post-R."] } },
  "Zac":{ role:["jungle","support"], tags:["engage","healing"], weak:["grievous","vision"], spikes:["6","Sunfire"], skills:"Max E > W > Q",
    runes:["Aftershock","Font","Bone Plating","Unflinching","Biscuit","Cosmic"], start:["Jungle item"],
    core:["Sunfire","Mercs","Demonic"], sit:["Thornmail","FoN","Gargoyle"],
    tips:{ early:["Ward long-range E slingshots."], mid:["Kill blobs; anti-heal helps."], late:["Avoid tight jungle E hits."] } }
});

/* — Merge: Chunk 3/3 ADC + Supports (representative set) — */
Object.assign(PROFILES, {
  "Ashe":{ role:["adc","support"], tags:["poke","utility","engage"], weak:["allin","burst"], spikes:["2 items","R pick"], skills:"Max W > Q > E",
    runes:["Lethal Tempo","Presence","Alacrity","Coup","Biscuit","Cosmic"], start:["Doran's Blade"],
    core:["Kraken","Berserker's","Runaan's"], sit:["GA","QSS","BT"],
    tips:{ early:["W poke on last-hits; keep wave centered."], mid:["Arrow from fog into objectives."], late:["Front-to-back; kite with slows."] } },
  "Ezreal":{ role:["adc"], tags:["safe","poke","mobility"], weak:["allin","cc"], spikes:["Manamune","2 items"], skills:"Max Q > E > W",
    runes:["First Strike","Manaflow","Transcendence","Scorch","Biscuit","Cosmic"], start:["Tear + Doran's Blade"],
    core:["Manamune","Trinity/Iceborn","Serylda"], sit:["GA","Maw","Frozen Heart"],
    tips:{ early:["Farm with Q; don’t E forward blind."], mid:["Poke before fights; collapse on connects."], late:["Play safe; DPS via Q spam."] } },
  "Jinx":{ role:["adc"], tags:["scaler","dps","aoe"], weak:["immobile","vs-engage"], spikes:["2 items","IE"], skills:"Max Q > W > E",
    runes:["Lethal Tempo","Presence","Bloodline","Coup","Taste","Treasure"], start:["Doran's Blade"],
    core:["Kraken","Berserker's","RFC"], sit:["QSS","GA","BT"],
    tips:{ early:["Respect all-ins; scale."], mid:["Rockets to soften before fights."], late:["Trust peel; position perfectly."] } },
  "Varus":{ role:["adc"], tags:["poke","onhit","flex"], weak:["dive","engage"], spikes:["Dirk (poke) / 2 items (onhit)"], skills:"Max Q (poke) / W (onhit)",
    runes:["First Strike/Press the Attack","Presence","Alacrity","Coup","Biscuit","Cosmic"], start:["Doran's Blade"],
    core:["Lethality: Youmuu's/Manamune","Onhit: Guinsoo's/Bork"], sit:["GA","QSS","Wit's End"],
    tips:{ early:["Harass with Q charge; manage mana."], mid:["Pick with R into objectives."], late:["Commit to poke or shred plan."] } },
  "Leona":{ role:["support"], tags:["engage","point-cc","tank"], weak:["poke","disengage","cleanse"], spikes:["2","6"], skills:"Max E > W > Q",
    runes:["Aftershock","Font","Bone Plating","Unflinching","Biscuit","Cosmic"], start:["Relic"],
    core:["Locket","Mercs","Knight's Vow"], sit:["Zeke's","Anathema's","Mikael's"],
    tips:{ early:["Only engage with ADC follow."], mid:["Flank with sweeper."], late:["Peel if behind."] } },
  "Lulu":{ role:["support"], tags:["enchanter","peel","polymorph"], weak:["vs-allin","engage"], spikes:["Mythic","Ardent"], skills:"Max E > W > Q",
    runes:["Aery","Manaflow","Transcendence","Scorch","Biscuit","Cosmic"], start:["Spellthief"],
    core:["Moonstone","Redemption","Ardent"], sit:["Mikael's","Putrifier"], tips:{ early:["Shield trades; deny engage with W."], mid:["Peel carry; track polymorph for assassin."], late:["Play behind front line."] } }
});

/***** matchup snippets (example pairs) *****/
const MATCHUPS = {
  "Ahri:Zed":[
    "Stand behind casters to cut Zed Q damage; trade after W is down.",
    "Charm his post-R reappear; early Seeker's/Plated flips the all-in."
  ],
  "Zed:Lux":[
    "Bait Q/E, then R through the snare; Ionian+Dirk spike is lethal.",
    "Don’t stand in minion line vs E+Q; play fog angles."
  ],
  "Yasuo:Malphite":[
    "Wind Wall Q poke; rush sustain + attack speed.",
    "Roam when he stacks armor; avoid extended trades."
  ],
  "Darius:Garen":[
    "Freeze near tower; punish last-hits with E pull.",
    "Executioner's early to cut passive regen."
  ],
  "Caitlyn:Jinx":[
    "Trap control in brushes; shove for plates.",
    "Respect Jinx 2-item spike; keep net for ganks."
  ]
};

/***** core advisory engine *****/
function buildAdvice(lane, youName, themName){
  const base = LANE_DEFAULTS[lane];
  const you = (PROFILES[youName] ? {...PROFILES[youName]} : { role:[lane], tags:[], weak:[], spikes:[], skills:"", runes:[], start:[], core:[], sit:[], tips:{early:[],mid:[],late:[]} }); you.name = youName;
  const them = (PROFILES[themName] ? {...PROFILES[themName]} : { role:[lane], tags:[], weak:[], spikes:[], skills:"", runes:[], start:[], core:[], sit:[], tips:{early:[],mid:[],late:[]} }); them.name = themName;

  // Build kits with strong fallbacks (always returns something)
  let summoners = you.summoners || base.sum;
  let runes = (you.runes && you.runes.length) ? you.runes : base.runes;
  let start = (you.start && you.start.length) ? you.start : base.start;
  let core = (you.core && you.core.length) ? you.core.slice() : base.core.slice();
  let sit  = uniq([...(you.sit||[]), ...(base.sit||[])]);

  // Scaling comparison & posture line
  const scale = compareScaling(you, them, lane);
  const postureLine = (scale.posture==="Aggressive")
    ? "You have scaling edge—look for **proactive trades/objectives** on timers."
    : (scale.posture==="Defensive" ? "They outscale—**play safe**, thin waves, trade sides, wait for spikes." : "Even scaling—play by **waves & jungler**.");

  // Basic plan scaffolding; keep original shape
  let plan = [postureLine];
  let extras = [];

  let role = roleTips(lane, you, them);
  // Only merge meta tips for the ENEMY champion (phrased as counters)
  mergeMetaTips(lane, themName, role, "enemy");
  // Curated overrides
  const curated = lookupCurated(lane, youName, themName);
  if(curated){
    // posture override
    if(curated.posture) scale.posture = curated.posture;
    // plan override
    const phaseLines = [];
    if(curated.overall) phaseLines.push(curated.overall);
    const bullets = [];
    (curated.early||[]).forEach(x=>bullets.push(`Early: ${x}`));
    (curated.mid||[]).forEach(x=>bullets.push(`Mid: ${x}`));
    (curated.late||[]).forEach(x=>bullets.push(`Late: ${x}`));
    if(phaseLines.length || bullets.length){
      plan = phaseLines.concat(bullets);
    }
    // role tips override/merge
    const youList = (curated.youTips||[]);
    const vsList = (curated.vsTips||[]).map(t=>`Vs ${themName}: ${t}`);
    if(youList.length || vsList.length){
      // put curated at top then keep generated role tips
      role.unshift(...youList, ...vsList);
    }
    // item/rune overrides if present
    if(curated.runes?.length) runes = curated.runes;
    if(curated.start?.length) start = curated.start;
    if(curated.core?.length) core = curated.core;
    extras.push("Curated matchup profile applied");
    var __curatedFlag = true;
  }
  try{
    const LO = (window.MATCHUP_LOADOUT || {});
    const over = LO[`${youName}|${themName}`];
    if(over){
      if(over.runes?.length) runes = over.runes;
      if(over.start?.length) start = over.start;
      if(over.core?.length)  core  = over.core;
      extras.push("Loadout tuned for this matchup");
    }
  }catch(e){}

  return {
    lane, youName, themName,
    summoners, runes, start,
    core: uniq(core),
    sit: uniq(sit),
    skills: you.skills || base.skills,
    plan: plan.filter(Boolean),
    extras,
    scale,
    role,
    verified70: (window.VERIFIED_70 && window.VERIFIED_70.has(`${youName}|${themName}`)),
    curated: (typeof __curatedFlag !== "undefined" ? curated : null)
  };
}


/***** render + UI wiring *****/
function renderAdvice(a){
  $("#results").style.display = "block";
  $("#youBadge").textContent = a.youName;
  $("#themBadge").textContent = a.themName;
  $("#laneBadge").textContent = a.lane.toUpperCase();

  $("#summoners").innerHTML = tags(a.summoners);
  $("#runes").innerHTML = tags(a.runes);
  $("#start").innerHTML = tags(a.start);
  $("#core").innerHTML = tags(a.core);
  $("#situational").innerHTML = tags(a.sit);
  $("#skills").innerHTML = tags([a.skills]);

  $("#plan").innerHTML = li([`${a.youName} (${a.lane}) vs ${a.themName}`, ...a.plan]);
  renderScalingSection(a.scale);
  $("#roleTips").innerHTML = li(a.role);
  $("#extras").textContent = a.extras.join(" • ");

  $("#copy").onclick = ()=>{
    const lines = [`${a.youName} (${a.lane}) vs ${a.themName}`]
      .concat(a.plan.map(x=>"• "+x))
      .concat(["","Summoners: "+a.summoners.join(", "),
               "Runes: "+a.runes.join(", "),
               "Start: "+a.start.join(", "),
               "Core: "+a.core.join(", "),
               "Situational: "+a.sit.join(", "),
               "Skills: "+a.skills]);
    const txt = lines.join("\n");
    navigator.clipboard?.writeText(txt).then(()=> setStatus("Copied ✓")).catch(()=> setStatus("Copy failed"));
  };
}

/* persistence + events */
function normName(s){ s=String(s||"").trim(); if(!s) return ""; const hit = CHAMPS.find(n=> n.toLowerCase()===s.toLowerCase()); return hit||s; }
function saveLast(){ localStorage.setItem("llc-last", JSON.stringify({ lane: $("#lane").value, you: $("#you").value, them: $("#them").value })); }
(function loadLast(){ try{ const j=JSON.parse(localStorage.getItem("llc-last")||"{}"); if(j.lane) $("#lane").value=j.lane; if(j.you) $("#you").value=j.you; if(j.them) $("#them").value=j.them; }catch{} })();

bindPicker("#you","#youList",CHAMPS);
bindPicker("#them","#themList",CHAMPS);

$("#swap").onclick = ()=>{ const a=$("#you").value; $("#you").value=$("#them").value; $("#them").value=a; saveLast(); };
$("#reset").onclick = ()=>{ $("#results").style.display="none"; $("#you").value=""; $("#them").value=""; setStatus("Ready"); localStorage.removeItem("llc-last"); };
$("#analyze").onclick = ()=>{
  const youRaw = $("#you").value, themRaw = $("#them").value, lane = $("#lane").value;
  const you = resolveChamp(youRaw), them = resolveChamp(themRaw);
  if(!you || !them){ setStatus("Unknown champ name"); return; }
  
  const a = buildAdvice(lane, you, them);
  renderAdvice(a); const t=$("#beginnerToggle"); if(t){ t.onchange=()=>renderAdvice(a); }
  saveLast();
};

setStatus("Ready");




/***** fuzzy resolver (safe wrapper to avoid recursion) *****/
(function(){
  const ABBR = {
    "ww":"Warwick","tf":"Twisted Fate","mf":"Miss Fortune","gp":"Gangplank",
    "lb":"LeBlanc","morde":"Mordekaiser","voli":"Volibear","trist":"Tristana",
    "kat":"Katarina","kata":"Katarina","panth":"Pantheon","malph":"Malphite",
    "jax":"Jax","eve":"Evelynn","ez":"Ezreal","ori":"Orianna","cho":"Cho'Gath",
    "blitz":"Blitzcrank","mundo":"Dr. Mundo","wu":"Wukong"
  };
  function levenshtein(a,b){
    a = String(a||"").toLowerCase();
    b = String(b||"").toLowerCase();
    const dp = Array(a.length+1).fill(0).map(()=>Array(b.length+1).fill(0));
    for(let i=0;i<=a.length;i++) dp[i][0] = i;
    for(let j=0;j<=b.length;j++) dp[0][j] = j;
    for(let i=1;i<=a.length;i++){
      for(let j=1;j<=b.length;j++){
        const cost = a[i-1] === b[j-1] ? 0 : 1;
        dp[i][j] = Math.min(dp[i-1][j]+1, dp[i][j-1]+1, dp[i-1][j-1]+cost);
      }
    }
    return dp[a.length][b.length];
  }
  const baseResolve = window.resolveChamp;
  window.resolveChamp = function(input){
    const raw = String(input||"").trim();
    const lower = raw.toLowerCase();
    if(ABBR[lower]) return ABBR[lower];
    const base = (typeof baseResolve === "function") ? baseResolve(raw) : null;
    if(base) return base;
    let best=null, bestD=3;
    for(const c of CHAMPS){
      const d = levenshtein(cleanKey(c), cleanKey(raw));
      if(d < bestD){ bestD=d; best=c; if(d===0) break; }
    }
    if(best && bestD<=2) return best;
    return null;
  };
})();

/* ===== Bulk curated matrix for top-10-per-role (auto-generated) ===== */
const TOP10 = {
  top: ["Darius","Garen","Sett","Fiora","Camille","Jax","Aatrox","Ornn","Renekton","Malphite"],
  jungle: ["Lee Sin","Master Yi","Kayn","Viego","Vi","Evelynn","Warwick","Kha'Zix","Fiddlesticks","Jarvan IV"],
  mid: ["Yasuo","Yone","Zed","Ahri","Katarina","Lux","Sylas","Viktor","Orianna","Akali"],
  adc: ["Jinx","Kai'Sa","Ezreal","Caitlyn","Vayne","Xayah","Samira","Draven","Miss Fortune","Aphelios"],
  support: ["Thresh","Leona","Nautilus","Lulu","Nami","Blitzcrank","Morgana","Pyke","Senna","Soraka"]
};

function archetypeFrom(profile){
  const tags = new Set((profile?.tags||[]).map(t=>t.toLowerCase()));
  if(tags.has("assassin")) return "assassin";
  if(tags.has("enchanter")||tags.has("shield")||tags.has("heal")) return "enchanter";
  if(tags.has("tank")) return "tank";
  if(tags.has("bruiser")||tags.has("fighter")||tags.has("skirmish")) return "bruiser";
  if(tags.has("poke")) return "poke";
  if(tags.has("control")||tags.has("mage")) return "control";
  if(tags.has("dps")) return "dps";
  return "general";
}

function postureFromDiff(diffSum){
  if(diffSum >= 2.2) return "Aggressive";
  if(diffSum <= -2.2) return "Defensive";
  return "Neutral";
}

// Template advice lines by posture + lane + archetypes
function templateAdvice(lane, you, them, scale){
  const youType = archetypeFrom(you);
  const themType = archetypeFrom(them);
  const p = scale.posture || "Neutral";
  const base = {overall:"", early:[], mid:[], late:[], youTips:[], vsTips:[]};

  // Overall
  if(p==="Aggressive") base.overall = "You out-tempo them now—push pace, take plates/objectives, and look for proactive trades.";
  else if(p==="Defensive") base.overall = "They out-tempo you now—avoid coinflip fights, farm safely, and trade sides until spikes.";
  else base.overall = "Similar power—play by waves and jungler position, look for clean picks not flips.";

  // Phase snippets based on scaling edges
  const dE = scale.diff?.early||0, dM = scale.diff?.mid||0, dL = scale.diff?.late||0;
  if(dE>0) base.early.push("Contest early objectives; trade when your cooldowns are up.");
  else if(dE<0) base.early.push("Respect early all-ins; thin waves near tower.");
  else base.early.push("Even early—track junglers and fight with prio.");

  if(dM>0) base.mid.push("Fight around your first mythic spike; move first on shove.");
  else if(dM<0) base.mid.push("Buy vision and avoid chokes on objectives; wait for items.");
  else base.mid.push("Even mid—set vision then look for numbers advantage.");

  if(dL>0) base.late.push("Take fights on timers; force picks before 5v5.");
  else if(dL<0) base.late.push("Avoid front-to-back; trade sides and play for waves.");
  else base.late.push("Even late—play front-to-back with vision.");

  // Lane/archetype flavor
  if(lane==="mid"){
    if(youType==="assassin"){ base.youTips.push("Roam on push; use fog to threaten side lanes."); }
    if(themType==="control"){ base.vsTips.push(`Vs ${them.name||"enemy"}: Don’t fight in narrow chokes; avoid extended poke.`); }
  }
  if(lane==="top"){
    if(youType==="bruiser"){ base.youTips.push("Crash cannon waves to take plates or force TP."); }
    if(themType==="tank"){ base.vsTips.push(`Vs ${them.name||"enemy"}: Track TP and avoid useless 5v5s.`); }
  }
  if(lane==="jungle"){
    if(youType==="assassin"){ base.youTips.push("Hover lanes with setup; path for gank timings, not full clears."); }
    if(themType==="tank"){ base.vsTips.push(`Vs ${them.name||"enemy"}: Don’t 50/50 objectives without prio.`); }
  }
  if(lane==="adc"){
    if(youType==="dps"||youType==="poke"){ base.youTips.push("Trade on support windows; don’t burn sums on losing waves."); }
    if(themType==="burst"||themType==="assassin"){ base.vsTips.push(`Vs ${them.name||"enemy"}: Stand behind minions and keep wave near tower.`); }
  }
  if(lane==="support"){
    if(youType==="tank"){ base.youTips.push("Engage from fog; sweep before looking for picks."); }
    if(youType==="enchanter"){ base.youTips.push("Track ally ADC spells; trade when they can follow."); }
  }
  return base;
}

// Build matrix entries for role top-10 lists.
// For each pair A vs B (A != B) in lane, compute scaling and produce curated entry if missing.
function buildCuratedMatrix(){
  for(const lane of Object.keys(TOP10)){
    const pool = TOP10[lane];
    for(let i=0;i<pool.length;i++){
      for(let j=0;j<pool.length;j++){
        if(i===j) continue;
        const A = pool[i], B = pool[j];
        const key = `${A}|${B}`;
        const L = lane.toLowerCase();
        MATCHUP_TIPS[L] = MATCHUP_TIPS[L] || {};
        if(MATCHUP_TIPS[L][key]) continue; // keep hand-written entries

        // Build profiles with names so scaling uses role overrides
        const you = (PROFILES[A] ? {...PROFILES[A]} : {role:[lane],tags:[],tips:{early:[],mid:[],late:[]}}); you.name = A;
        const them = (PROFILES[B] ? {...PROFILES[B]} : {role:[lane],tags:[],tips:{early:[],mid:[],late:[]}}); them.name = B;

        const sc = compareScaling(you, them, L);
        const sum = (sc.diff.early*1.0 + sc.diff.mid*1.3 + sc.diff.late*1.2);
        const posture = postureFromDiff(sum);
        const templ = templateAdvice(L, you, them, {...sc, posture});

        MATCHUP_TIPS[L][key] = {
          posture,
          overall: templ.overall,
          early: templ.early,
          mid: templ.mid,
          late: templ.late,
          youTips: templ.youTips,
          vsTips: templ.vsTips,
          _auto: true
        };
      }
    }
  }
}

// Tag UI when curated entry is auto-generated
(function(){
  const oldLookup = lookupCurated;
  lookupCurated = function(lane, youName, themName){
    const found = oldLookup(lane, youName, themName);
    if(found) return found;
    // Ensure matrix is ready, then return
    try { buildCuratedMatrix(); } catch(e){ /* no-op */ }
    const L = (lane||"").toLowerCase();
    const key = `${youName}|${themName}`;
    return (MATCHUP_TIPS[L]||{})[key] || null;
  };
})();
</script>
<script>for(const k in {"Lucian": {"adc": {"early": 2, "mid": 2, "late": 1}, "mid": {"early": 2, "mid": 2, "late": 1}}, "Kog'Maw": {"adc": {"early": 0, "mid": 2, "late": 4}, "mid": {"early": 0, "mid": 2, "late": 4}}, "Volibear": {"top": {"early": 2, "mid": 2, "late": 1}, "jungle": {"early": 2, "mid": 2, "late": 1}}, "Brand": {"mid": {"early": 1, "mid": 2, "late": 2}, "support": {"early": 1, "mid": 2, "late": 2}}, "Neeko": {"mid": {"early": 1, "mid": 2, "late": 2}, "support": {"early": 1, "mid": 2, "late": 2}}, "Karma": {"mid": {"early": 1, "mid": 2, "late": 2}, "support": {"early": 1, "mid": 2, "late": 2}}, "Swain": {"mid": {"early": 0, "mid": 2, "late": 3}, "support": {"early": 0, "mid": 2, "late": 3}}, "Morgana": {"support": {"early": 0, "mid": 2, "late": 3}, "jungle": {"early": 1, "mid": 2, "late": 2}}, "Malphite": {"top": {"early": 0, "mid": 1, "late": 3}, "mid": {"early": 1, "mid": 2, "late": 2}}, "Tristana": {"adc": {"early": 2, "mid": 2, "late": 1}, "mid": {"early": 2, "mid": 2, "late": 1}}, "Vladimir": {"mid": {"early": 0, "mid": 1, "late": 4}, "top": {"early": 0, "mid": 1, "late": 4}}, "Karthus": {"mid": {"early": 0, "mid": 2, "late": 3}, "jungle": {"early": 0, "mid": 2, "late": 3}}, "Pantheon": {"mid": {"early": 3, "mid": 1, "late": 0}, "jungle": {"early": 2, "mid": 1, "late": 0}, "support": {"early": 2, "mid": 1, "late": 0}}}){ ROLE_SCALING_DB[k] = Object.assign(ROLE_SCALING_DB[k]||{}, {"Lucian": {"adc": {"early": 2, "mid": 2, "late": 1}, "mid": {"early": 2, "mid": 2, "late": 1}}, "Kog'Maw": {"adc": {"early": 0, "mid": 2, "late": 4}, "mid": {"early": 0, "mid": 2, "late": 4}}, "Volibear": {"top": {"early": 2, "mid": 2, "late": 1}, "jungle": {"early": 2, "mid": 2, "late": 1}}, "Brand": {"mid": {"early": 1, "mid": 2, "late": 2}, "support": {"early": 1, "mid": 2, "late": 2}}, "Neeko": {"mid": {"early": 1, "mid": 2, "late": 2}, "support": {"early": 1, "mid": 2, "late": 2}}, "Karma": {"mid": {"early": 1, "mid": 2, "late": 2}, "support": {"early": 1, "mid": 2, "late": 2}}, "Swain": {"mid": {"early": 0, "mid": 2, "late": 3}, "support": {"early": 0, "mid": 2, "late": 3}}, "Morgana": {"support": {"early": 0, "mid": 2, "late": 3}, "jungle": {"early": 1, "mid": 2, "late": 2}}, "Malphite": {"top": {"early": 0, "mid": 1, "late": 3}, "mid": {"early": 1, "mid": 2, "late": 2}}, "Tristana": {"adc": {"early": 2, "mid": 2, "late": 1}, "mid": {"early": 2, "mid": 2, "late": 1}}, "Vladimir": {"mid": {"early": 0, "mid": 1, "late": 4}, "top": {"early": 0, "mid": 1, "late": 4}}, "Karthus": {"mid": {"early": 0, "mid": 2, "late": 3}, "jungle": {"early": 0, "mid": 2, "late": 3}}, "Pantheon": {"mid": {"early": 3, "mid": 1, "late": 0}, "jungle": {"early": 2, "mid": 1, "late": 0}, "support": {"early": 2, "mid": 1, "late": 0}}}[k]); }</script>
<script>Object.assign(SCALING_DB, {"Cassiopeia": {"early": 0, "mid": 2, "late": 3}, "Malzahar": {"early": 0, "mid": 2, "late": 2}, "Galio": {"early": 1, "mid": 2, "late": 1}, "Corki": {"early": 0, "mid": 2, "late": 3}, "Brand": {"early": 1, "mid": 2, "late": 2}, "Heimerdinger": {"early": 2, "mid": 2, "late": 1}, "Neeko": {"early": 1, "mid": 2, "late": 2}, "Sylas": {"early": 1, "mid": 2, "late": 2}, "Akshan": {"early": 1, "mid": 2, "late": 2}, "Lux": {"early": 1, "mid": 2, "late": 2}, "Karthus": {"early": 0, "mid": 2, "late": 3}, "Vladimir": {"early": 0, "mid": 1, "late": 4}, "Karma": {"early": 1, "mid": 2, "late": 2}, "Irelia": {"early": 1, "mid": 2, "late": 2}, "Sett": {"early": 2, "mid": 2, "late": 1}, "Yorick": {"early": 1, "mid": 2, "late": 2}, "Illaoi": {"early": 2, "mid": 2, "late": 1}, "Volibear": {"early": 2, "mid": 2, "late": 1}, "Cho'Gath": {"early": 1, "mid": 2, "late": 2}, "Tahm Kench": {"early": 1, "mid": 2, "late": 2}, "Teemo": {"early": 1, "mid": 2, "late": 2}, "Rengar": {"early": 2, "mid": 2, "late": 1}, "Nidalee": {"early": 2, "mid": 2, "late": 0}, "Elise": {"early": 3, "mid": 1, "late": 0}, "Jarvan IV": {"early": 2, "mid": 2, "late": 1}, "Zac": {"early": 1, "mid": 2, "late": 2}, "Nunu & Willump": {"early": 1, "mid": 2, "late": 2}, "Shaco": {"early": 2, "mid": 2, "late": 1}, "Olaf": {"early": 2, "mid": 2, "late": 0}, "Kindred": {"early": 1, "mid": 2, "late": 2}, "Skarner": {"early": 1, "mid": 2, "late": 1}, "Kog'Maw": {"early": 0, "mid": 2, "late": 4}, "Jhin": {"early": 1, "mid": 2, "late": 2}, "Lucian": {"early": 2, "mid": 2, "late": 1}, "Varus": {"early": 1, "mid": 2, "late": 2}, "Kalista": {"early": 2, "mid": 2, "late": 0}, "Zyra": {"early": 1, "mid": 2, "late": 2}, "Renata Glasc": {"early": 1, "mid": 2, "late": 2}, "Milio": {"early": 0, "mid": 2, "late": 3}, "Yuumi": {"early": 0, "mid": 1, "late": 4}});</script>
<script>
Object.assign(SCALING_DB, {"Ahri": {"early": 1, "mid": 2, "late": 1}, "Yasuo": {"early": 1, "mid": 2, "late": 2}, "Yone": {"early": 1, "mid": 2, "late": 2}, "Zed": {"early": 2, "mid": 2, "late": 0}, "Lux": {"early": 1, "mid": 2, "late": 2}, "Jinx": {"early": 0, "mid": 2, "late": 3}, "Kai'Sa": {"early": 1, "mid": 2, "late": 2}, "Ezreal": {"early": 0, "mid": 2, "late": 2}, "Caitlyn": {"early": 2, "mid": 1, "late": 1}, "Vayne": {"early": 0, "mid": 2, "late": 3}, "Lee Sin": {"early": 2, "mid": 2, "late": 0}, "Master Yi": {"early": 0, "mid": 2, "late": 3}, "Kayn": {"early": 1, "mid": 2, "late": 2}, "Viego": {"early": 1, "mid": 2, "late": 2}, "Thresh": {"early": 1, "mid": 2, "late": 2}, "Leona": {"early": 2, "mid": 2, "late": 1}, "Nautilus": {"early": 2, "mid": 2, "late": 1}, "Lulu": {"early": 0, "mid": 2, "late": 3}, "Nami": {"early": 1, "mid": 2, "late": 2}, "Garen": {"early": 2, "mid": 1, "late": 1}});
window.ROLE_SCALING_DB = window.ROLE_SCALING_DB || {};
for(const k in {"Lux": {"mid": {"early": 1, "mid": 2, "late": 2}, "support": {"early": 0, "mid": 2, "late": 2}}, "Yasuo": {"mid": {"early": 1, "mid": 2, "late": 2}, "top": {"early": 1, "mid": 2, "late": 2}}, "Yone": {"mid": {"early": 1, "mid": 2, "late": 2}, "top": {"early": 1, "mid": 2, "late": 2}}, "Kai'Sa": {"adc": {"early": 1, "mid": 2, "late": 2}, "mid": {"early": 1, "mid": 2, "late": 2}}, "Garen": {"top": {"early": 2, "mid": 1, "late": 1}}, "Lee Sin": {"jungle": {"early": 2, "mid": 2, "late": 0}}, "Kayn": {"jungle": {"early": 1, "mid": 2, "late": 2}}, "Viego": {"jungle": {"early": 1, "mid": 2, "late": 2}}, "Thresh": {"support": {"early": 1, "mid": 2, "late": 2}}, "Leona": {"support": {"early": 2, "mid": 2, "late": 1}}, "Nautilus": {"support": {"early": 2, "mid": 2, "late": 1}}, "Lulu": {"support": {"early": 0, "mid": 2, "late": 3}}, "Nami": {"support": {"early": 1, "mid": 2, "late": 2}}, "Jinx": {"adc": {"early": 0, "mid": 2, "late": 3}}, "Ezreal": {"adc": {"early": 0, "mid": 2, "late": 2}}, "Caitlyn": {"adc": {"early": 2, "mid": 1, "late": 1}}, "Vayne": {"adc": {"early": 0, "mid": 2, "late": 3}}}){
  ROLE_SCALING_DB[k] = Object.assign(ROLE_SCALING_DB[k]||{}, {"Lux": {"mid": {"early": 1, "mid": 2, "late": 2}, "support": {"early": 0, "mid": 2, "late": 2}}, "Yasuo": {"mid": {"early": 1, "mid": 2, "late": 2}, "top": {"early": 1, "mid": 2, "late": 2}}, "Yone": {"mid": {"early": 1, "mid": 2, "late": 2}, "top": {"early": 1, "mid": 2, "late": 2}}, "Kai'Sa": {"adc": {"early": 1, "mid": 2, "late": 2}, "mid": {"early": 1, "mid": 2, "late": 2}}, "Garen": {"top": {"early": 2, "mid": 1, "late": 1}}, "Lee Sin": {"jungle": {"early": 2, "mid": 2, "late": 0}}, "Kayn": {"jungle": {"early": 1, "mid": 2, "late": 2}}, "Viego": {"jungle": {"early": 1, "mid": 2, "late": 2}}, "Thresh": {"support": {"early": 1, "mid": 2, "late": 2}}, "Leona": {"support": {"early": 2, "mid": 2, "late": 1}}, "Nautilus": {"support": {"early": 2, "mid": 2, "late": 1}}, "Lulu": {"support": {"early": 0, "mid": 2, "late": 3}}, "Nami": {"support": {"early": 1, "mid": 2, "late": 2}}, "Jinx": {"adc": {"early": 0, "mid": 2, "late": 3}}, "Ezreal": {"adc": {"early": 0, "mid": 2, "late": 2}}, "Caitlyn": {"adc": {"early": 2, "mid": 1, "late": 1}}, "Vayne": {"adc": {"early": 0, "mid": 2, "late": 3}}}[k]);
}
</script>
</div>
<hr class="sep"><section id="how" class="card" style="margin-top:14px;"><h3 class="section-title">How to use</h3><div class="grid" style="grid-template-columns: 1fr 2fr; gap:14px;"><div class="stack"><div class="inline" style="gap:10px;"><div class="tag">1</div><div><b>Pick lane & champs</b><div class="small muted">Choose your lane, your champ, and the enemy.</div></div></div><div class="inline" style="gap:10px;"><div class="tag">2</div><div><b>Analyze</b><div class="small muted">See posture (Aggressive / Neutral / Defensive), scaling (E/M/L), and a lane plan.</div></div></div><div class="inline" style="gap:10px;"><div class="tag">3</div><div><b>Execute</b><div class="small muted">Follow Early/Mid/Late bullets and role tips. Beginner Mode simplifies the plan.</div></div></div></div><div class="kv"><h4>Tips</h4><ul class="small muted" style="margin:0;padding-left:18px;"><li>Look for <b>Verified 70%</b> on popular matchups (hand-checked).</li><li>Hover scaling bars to see whether data is curated, role-curated, or heuristic.</li><li>Use <b>Swap</b> to view the reverse perspective.</li></ul></div></div></section>
<div class="footer small"><div>© Matchup Coach — beta</div><div>Tips are guidance, not guarantees. <a class="small feedback-link" target="_blank" rel="noopener" href="https://forms.gle/tmunxY3poZrrD6FL9">💬 Send Feedback</a>.</div></div>

<script>
/* ===== Priority Curated Seeding for 70% Testing Plan (both directions) ===== */
const PRIORITY_PAIRS = {
  top: [
    ["Darius","Fiora"],["Garen","Darius"],["Sett","Camille"],["Jax","Malphite"],
    ["Renekton","Ornn"],["Aatrox","Camille"],["Fiora","Malphite"],["Camille","Ornn"],
    ["Jax","Renekton"],["Garen","Fiora"],["Aatrox","Jax"],["Renekton","Darius"]
  ],
  jungle: [
    ["Lee Sin","Master Yi"],["Kayn","Sejuani"],["Viego","Vi"],["Evelynn","Lee Sin"],
    ["Warwick","Kha'Zix"],["Graves","Amumu"],["Hecarim","Vi"],["Kha'Zix","Jarvan IV"],
    ["Kindred","Sejuani"],["Jarvan IV","Master Yi"],["Nocturne","Viego"],["Fiddlesticks","Lee Sin"]
  ],
  mid: [
    ["Yasuo","Zed"],["Ahri","Yasuo"],["Yone","Viktor"],["Katarina","Lux"],
    ["Akali","Orianna"],["Zed","Ryze"],["Sylas","Viktor"],["Ahri","Katarina"],
    ["Twisted Fate","Yasuo"],["Veigar","Yone"],["Fizz","Orianna"],["LeBlanc","Viktor"]
  ],
  adc: [
    ["Jinx","Caitlyn"],["Kai'Sa","Ezreal"],["Vayne","Draven"],["Xayah","Samira"],
    ["Aphelios","Miss Fortune"],["Ezreal","Draven"],["Jinx","Vayne"],["Caitlyn","Miss Fortune"],
    ["Draven","Kai'Sa"],["Samira","Ezreal"],["Sivir","Jhin"],["Ashe","Caitlyn"]
  ],
  support: [
    ["Thresh","Lulu"],["Leona","Morgana"],["Nautilus","Janna"],["Blitzcrank","Morgana"],
    ["Pyke","Senna"],["Nami","Leona"],["Lulu","Nautilus"],["Rakan","Thresh"],
    ["Bard","Lulu"],["Renata Glasc","Nami"],["Soraka","Blitzcrank"],["Morgana","Leona"]
  ]
};

// Optional special-case extra tips for iconic duels
const SPECIAL_TIPS = {
  "Fiora|Darius": {
    youTips: ["Parry (W) Darius pull or R for winning trades.", "Play around vitals; short trades after his E."],
    vsTips: ["Buy early armor/Tabi; don’t give 5-stack angles."]
  },
  "Darius|Fiora": {
    youTips: ["Hold E to punish her Q; don’t waste Ghost early.", "Zone with Q blade; trade on her W cooldown."],
    vsTips: ["Respect 5 stacks; don’t dash in blindly."]
  },
  "Lee Sin|Master Yi": {
    youTips: ["Invade with prio; punish Alpha end with Q or kick."],
    vsTips: ["Avoid early 2v2s; path to scale for 2 items."]
  },
  "Vayne|Draven": {
    youTips: ["Don’t contest early all-ins; farm for 2 items.", "Tumble sideways, not back, to dodge axes."],
    vsTips: ["Force 2v2s early; setup dives with wave stack."]
  },
  "Ahri|Yasuo": {
    youTips: ["Don’t Q into Wind Wall; pick angles from fog.", "Charm after dash to stop engage."],
    vsTips: ["Track charm; punish after it’s down."]
  }
};

function seededTemplateAdvice(lane, you, them, sc){
  // Use the same templateAdvice if available; otherwise build a strong baseline
  let base;
  if(typeof templateAdvice === "function"){
    base = templateAdvice(lane, you, them, sc);
  } else {
    base = { overall:"", early:[], mid:[], late:[], youTips:[], vsTips:[] };
    const p = sc.posture;
    base.overall = (p==="Aggressive") ? "You out-tempo them now—push pace and secure objectives." :
                   (p==="Defensive") ? "They out-tempo you—avoid flips, trade sides, and farm to spikes." :
                                      "Similar power—play by waves and jungler position.";
    const dE=sc.diff.early, dM=sc.diff.mid, dL=sc.diff.late;
    base.early.push(dE>0?"Contest early skirmishes on prio.":dE<0?"Respect early all-ins; thin waves near tower.":"Even early—track junglers.");
    base.mid.push(dM>0?"Fight around your first item spikes.":dM<0?"Avoid chokes on objectives; buy vision.":"Even mid—look for numbers advantage.");
    base.late.push(dL>0?"Force picks before 5v5; press lead on timers.":dL<0?"Trade sides and avoid front-to-back.":"Even late—front-to-back with vision.");
  }
  const sk = `${you.name}|${them.name}`;
  const sp = SPECIAL_TIPS[sk] || {};
  if(sp.youTips) base.youTips = [...sp.youTips, ...base.youTips];
  if(sp.vsTips)  base.vsTips  = [...sp.vsTips,  ...base.vsTips];
  return base;
}

function seedPriorityCurated(){
  for(const lane of Object.keys(PRIORITY_PAIRS)){
    const L = lane.toLowerCase();
    MATCHUP_TIPS[L] = MATCHUP_TIPS[L] || {};
    for(const [A,B] of PRIORITY_PAIRS[lane]){
      for(const [youName, themName] of [[A,B],[B,A]]){
        const key = `${youName}|${themName}`;
        // Keep existing hand-written entries
        if(MATCHUP_TIPS[L][key] && !MATCHUP_TIPS[L][key]._auto) continue;
        // Build profiles to respect role-aware scaling
        const you = (PROFILES[youName] ? {...PROFILES[youName]} : {role:[lane],tags:[],tips:{early:[],mid:[],late:[]}}); you.name = youName;
        const them = (PROFILES[themName] ? {...PROFILES[themName]} : {role:[lane],tags:[],tips:{early:[],mid:[],late:[]}}); them.name = themName;
        const sc = compareScaling(you, them, L);
        // Stronger posture threshold for curated seeds
        const sum = (1.0*sc.diff.early + 1.3*sc.diff.mid + 1.2*sc.diff.late);
        sc.posture = (sum >= 2.2) ? "Aggressive" : (sum <= -2.2) ? "Defensive" : "Neutral";
        // Build advice text
        const templ = seededTemplateAdvice(L, you, them, sc);
        MATCHUP_TIPS[L][key] = {
          posture: sc.posture,
          overall: templ.overall,
          early: templ.early,
          mid: templ.mid,
          late: templ.late,
          youTips: templ.youTips,
          vsTips: templ.vsTips,
          _auto: false,
          _seeded: true
        };
      }
    }
  }
}

// Ensure seeds are applied very early
(function(){
  try { seedPriorityCurated(); } catch(e){ console.warn("Curated seed failed", e); }
})();
</script>


<script>
window.VERIFIED_70 = new Set();
try{
  for(const lane of Object.keys(PRIORITY_PAIRS||{})){
    for(const [A,B] of PRIORITY_PAIRS[lane]){
      VERIFIED_70.add(`${A}|${B}`);
      VERIFIED_70.add(`${B}|${A}`);
    }
  }
}catch(e){}
</script>

<script>window.MATCHUP_LOADOUT = {"Jax|Malphite": {"start": ["Doran's Shield"], "core": ["Divine Sunderer", "Blade of the Ruined King", "Plated/Mercs"], "runes": ["Conqueror", "Triumph", "Alacrity", "Last Stand", "Second Wind", "Unflinching"]}};</script>

<script>
document.addEventListener("DOMContentLoaded", function(){
  const laneSel = document.querySelector("#lane");
  if(laneSel){
    const label = laneSel.closest("label.picker");
    if(label) label.classList.add("lane-accent");
  }
});
</script>

</body>
</html>

